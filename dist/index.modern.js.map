{"version":3,"file":"index.modern.js","sources":["../node_modules/classnames/index.js","../src/constants/index.ts","../src/helpers/playback.ts","../src/store/playback.ts","../src/components/Fader/FaderThumb.tsx","../src/components/Fader/helpers.ts","../src/components/Fader/index.tsx","../src/hooks/useCurrentPosition.ts","../src/helpers/audio.ts","../src/helpers/node.ts","../src/helpers/entities.ts","../src/store/helpers.ts","../src/models/track.ts","../src/models/mixer.ts","../src/store/store.ts","../src/hooks/useMixer.ts","../src/hooks/useProgress.ts","../src/hooks/useMxContext.tsx","../src/components/Desk/components/ProgressBar.tsx","../src/components/Desk/components/PlayController.tsx","../src/components/Desk/components/VolumeController.tsx","../src/components/MasterTrack/helpers.ts","../src/components/MasterTrack/index.tsx","../src/containers/Context/Context.ts","../src/models/fx/fx-base.ts","../src/models/fx/delay.ts","../src/models/fx/distortion.ts","../src/models/fx/reverb.ts","../src/containers/Mixdesk/Mixdesk.tsx","../src/containers/Desk/Desk.tsx","../src/components/Radio/index.js","../src/components/EffectParameter/index.tsx","../src/components/Effect/index.tsx","../src/containers/Effect/Effect.tsx","../src/components/Knob/index.tsx","../src/components/Track/index.tsx","../src/containers/Track/Tracks.tsx","../src/components/Desk/index.tsx"],"sourcesContent":["/*!\n  Copyright (c) 2018 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames() {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\tif (arg.length) {\n\t\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\t\tif (inner) {\n\t\t\t\t\t\tclasses.push(inner);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tif (arg.toString === Object.prototype.toString) {\n\t\t\t\t\tfor (var key in arg) {\n\t\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tclasses.push(arg.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","export enum PLAYBACK_STATUS {\r\n    PLAYING = 'PLAYING',\r\n    PAUSED = 'PAUSED',\r\n    READY = 'READY',\r\n    FAILED = 'FAILED',\r\n    NOT_SET = 'NOT_SET',\r\n};\r\n\r\nexport enum CONTEXT_STATE {\r\n    RUNNING = 'running',\r\n    SUSPENDED = 'suspended',\r\n}\r\n\r\nexport enum TRACK_STATE {\r\n    LOADING = 'LOADING',\r\n    READY = 'READY',\r\n    FAILED = 'FAILED',\r\n    NOT_SET = 'NOT_SET',\r\n};\r\n\r\nexport enum FILTER_TYPES {\r\n\tLOWPASS = 'lowpass',\r\n\tHIGHPASS = 'highpass',\r\n\tBANDPASS = 'bandpass',\r\n};\r\n","import {map, not} from 'ramda';\r\n\r\nimport {\r\n    PLAYBACK_STATUS,\r\n} from '../constants';\r\n\r\nexport const isPlaying = status => status === PLAYBACK_STATUS.PLAYING;\r\n\r\nexport const isPaused = status => status === PLAYBACK_STATUS.PAUSED; //@TODO: && playback.currentPosition !== 0;\r\n\r\nexport const isReady = status => status === PLAYBACK_STATUS.READY;\r\n\r\nexport const isActive = status => (isPlaying(status) || isPaused(status) || isReady(status));\r\n\r\nexport const isNotActive = status => not(isActive(status));\r\n\r\nexport const playAll = map(track => track.play());\r\n\r\nexport const pauseAll = map(track => track.pause());\r\n\r\nexport const rewindAll = map(track => {\r\n    track.stop();\r\n    track.play();\r\n});\r\n\r\nexport const stopAll = map(track => track.stop());\r\n","import { atom, selector } from 'recoil'\r\n\r\nexport const analyserState = atom({\r\n  key: 'analyserState',\r\n  default: null\r\n})\r\n\r\nexport const statusState = atom({\r\n  key: 'statusState',\r\n  default: 'NOT_SET'\r\n})\r\n\r\nexport const currentPositionState = atom({\r\n  key: 'currentPositionState',\r\n  default: 0\r\n})\r\n\r\nexport const durationState = atom({\r\n  key: 'durationState',\r\n  default: 0\r\n})\r\n\r\nexport const isLoopedState = atom({\r\n  key: 'isLoopedState',\r\n  default: false\r\n})\r\n\r\nexport const masterVolumeState = atom({\r\n  key: 'masterVolumeState',\r\n  default: 0\r\n})\r\n\r\nexport const progressBarSelector = selector({\r\n  key: 'progressBarSelector',\r\n  get: ({get}) => {\r\n    const currentPosition = get(currentPositionState);\r\n    const duration = get(durationState);\r\n\r\n    return {currentPosition, duration}\r\n  }\r\n});\r\n\r\n","import React from 'react'\r\n\r\nimport style from './style.module.css'\r\n\r\nconst FaderThumb = ({\r\n  position = 0,\r\n  isVertical = false,\r\n  events = {},\r\n  isKnobThumb = false,\r\n  className\r\n}) => {\r\n  const styleProperty = isVertical ? 'bottom' : 'left'\r\n  const stylePropertyValue = position + '%'\r\n\r\n  return (\r\n    <div data-thumb>\r\n      <div\r\n        className={`${style.thumb} ${className}`}\r\n        style={{\r\n          [styleProperty]: stylePropertyValue\r\n        }}\r\n        {...events}\r\n      >\r\n      </div>\r\n      {isKnobThumb && <div className={style.knobControl} style={{\r\n          width: stylePropertyValue\r\n        }}></div>}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default FaderThumb\r\n","/**\r\n * @returns {number} vertical coordinate from touch or mouse event\r\n */\r\nexport const getY = (event) =>\r\n  event.touches ? event.touches[0].pageY : event.pageY\r\n\r\n/**\r\n * @returns {number} horizontal coordinate from touch or move event\r\n */\r\nexport const getX = (event) =>\r\n  event.touches ? event.touches[0].pageX : event.pageX\r\n\r\n/**\r\n * @returns {number} relative position in percents\r\n */\r\nexport const getPointerVerticalPosition = (\r\n  position,\r\n  { top, bottom, height }\r\n) => {\r\n  let value = position\r\n\r\n  if (value < top) value = top\r\n  if (value > bottom) value = bottom\r\n\r\n  value = bottom - value\r\n\r\n  return value / (height / 100)\r\n}\r\n\r\n/**\r\n * @returns {number} relative position in percents\r\n */\r\nexport const getPointerHorizontalPosition = (position, { width, left }) => {\r\n  let value = position // max(min(position, left + width), left) - left;\r\n\r\n  const rightBorder = left + width\r\n\r\n  if (value > rightBorder) value = rightBorder\r\n  if (value < left) value = left\r\n\r\n  value = value - left\r\n\r\n  return value / (width / 100)\r\n}\r\n\r\nexport const getCloserToDefaultValue = (value, defaultValue = 70) => {\r\n  return Number(value) <= Number(defaultValue + 10) &&\r\n    Number(value) >= Number(defaultValue - 10)\r\n    ? defaultValue\r\n    : value\r\n}\r\n","import React, { useRef, useState } from 'react'\r\nimport classnames from 'classnames'\r\n\r\nimport FaderThumb from './FaderThumb'\r\n\r\nimport {\r\n  getX,\r\n  getY,\r\n  getPointerVerticalPosition,\r\n  getPointerHorizontalPosition,\r\n  getCloserToDefaultValue\r\n} from './helpers'\r\n\r\nimport style from './style.module.css'\r\n\r\nconst EVENTS_MAP = {\r\n  mousemove: 'touchmove',\r\n  mouseup: 'touchend',\r\n  mousedown: 'touchstart'\r\n}\r\n\r\nconst isServer = typeof window === 'undefined'\r\n\r\nconst hasTouchEventsSupport = () => !isServer && 'ontouchstart' in window\r\n\r\nconst getEventNameByFeature = (eventName) =>\r\n  hasTouchEventsSupport() ? EVENTS_MAP[eventName] : eventName\r\n\r\ninterface FaderProps {\r\n  value?: number\r\n  isVertical?: boolean\r\n  isKnobThumb?: boolean\r\n  // TODO: ðŸ¤¯ Refactor onChange due to type inconsistency\r\n  onChange?: any\r\n  // On change end is used for the Progress Bar, no need for progressional change\r\n  onChangeEnd?: (value) => void\r\n  onDoubleClick?: (id) => void\r\n  className?: string\r\n}\r\n\r\nconst Fader: React.FC<FaderProps> = ({\r\n  value = 0,\r\n  isVertical = false,\r\n  isKnobThumb = false,\r\n  onChange = () => {},\r\n  onChangeEnd = () => {},\r\n  onDoubleClick,\r\n  className = ''\r\n}) => {\r\n  const containerRef = useRef<HTMLDivElement>(null)\r\n\r\n  const [isDragging, setIsDragging] = useState(false)\r\n\r\n  const onMoveStart = (event) => {\r\n    event.preventDefault()\r\n\r\n    document.documentElement.addEventListener(\r\n      getEventNameByFeature('mousemove'),\r\n      onMove\r\n    )\r\n    document.documentElement.addEventListener(\r\n      getEventNameByFeature('mouseup'),\r\n      onMoveEnd\r\n    )\r\n\r\n    return false\r\n  }\r\n\r\n  const onMove = (event) => {\r\n    event.preventDefault()\r\n    triggerChangeEvent(event, onChange)\r\n    return false\r\n  }\r\n\r\n  const onMoveEnd = (event) => {\r\n    event.preventDefault()\r\n    document.documentElement.removeEventListener(\r\n      getEventNameByFeature('mousemove'),\r\n      onMove\r\n    )\r\n    document.documentElement.removeEventListener(\r\n      getEventNameByFeature('mouseup'),\r\n      onMoveEnd\r\n    )\r\n    triggerChangeEvent(event, onChangeEnd)\r\n    setIsDragging(false)\r\n    return false\r\n  }\r\n\r\n  let timeout\r\n\r\n  const triggerChangeEvent = (event, changeCallback) => {\r\n    if (timeout) {\r\n      cancelAnimationFrame(timeout)\r\n    }\r\n\r\n    timeout = requestAnimationFrame(() => {\r\n      setIsDragging(true)\r\n      const containerElement = containerRef.current\r\n      const offset =\r\n        containerElement && containerElement.getBoundingClientRect()\r\n      const x = getX(event) - document.documentElement.scrollLeft\r\n      const y = getY(event) - document.documentElement.scrollTop\r\n\r\n      const newValue = isVertical\r\n        ? getPointerVerticalPosition(y, offset)\r\n        : getPointerHorizontalPosition(x, offset)\r\n\r\n      changeCallback(getCloserToDefaultValue(newValue))\r\n    })\r\n    return false\r\n  }\r\n\r\n  const thumbEventName = hasTouchEventsSupport()\r\n    ? 'onTouchStart'\r\n    : 'onMouseDown'\r\n\r\n  const onClick = (event) =>\r\n    onChangeEnd(\r\n      ((event.clientX - containerRef.current.offsetLeft) /\r\n        containerRef.current.offsetWidth) *\r\n        100\r\n    )\r\n\r\n  return (\r\n    <div\r\n      className={classnames(\r\n        style.fader,\r\n        !isVertical && style.isHorisontal,\r\n        isKnobThumb && style.isKnobThumb,\r\n        isDragging && style.isDragging\r\n      )}\r\n      ref={containerRef}\r\n      onClick={onClick}\r\n    >\r\n      <div className={style.control}>\r\n        <FaderThumb\r\n          position={value}\r\n          events={{\r\n            [thumbEventName]: onMoveStart,\r\n            onDoubleClick: onDoubleClick\r\n          }}\r\n          isVertical={isVertical}\r\n          isKnobThumb={isKnobThumb}\r\n          className={className}\r\n        />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Fader\r\n","import {\r\n  useRef,\r\n  DependencyList,\r\n  useLayoutEffect\r\n} from 'react'\r\n\r\ninterface IPosition {\r\n  x: number\r\n  y: number\r\n}\r\n\r\ninterface IScrollProps {\r\n  prevPos: IPosition\r\n  currPos: IPosition\r\n}\r\n\r\nconst isBrowser = typeof window !== `undefined`\r\nconst zeroPosition = { x: 0, y: 0 }\r\n\r\nconst getScrollPosition = () => {\r\n  if (!isBrowser) {\r\n    return zeroPosition\r\n  }\r\n\r\n    return { x: window.scrollX, y: window.scrollY }\r\n}\r\n\r\nexport const useScrollPosition = (\r\n  effect: (props: IScrollProps) => void,\r\n  deps?: DependencyList,\r\n  wait?: number\r\n): void => {\r\n  const position = useRef(getScrollPosition())\r\n\r\n  let throttleTimeout: number | null = null\r\n\r\n  const callBack = () => {\r\n    const currPos = getScrollPosition()\r\n    effect({ prevPos: position.current, currPos })\r\n    position.current = currPos\r\n    throttleTimeout = null\r\n  }\r\n\r\n  useLayoutEffect(() => {\r\n    if (!isBrowser) {\r\n      return undefined\r\n    }\r\n\r\n    const handleScroll = () => {\r\n      if (wait) {\r\n        if (throttleTimeout === null) {\r\n          throttleTimeout = window.setTimeout(callBack, wait)\r\n        }\r\n      } else {\r\n        callBack()\r\n      }\r\n    }\r\n\r\n    window.addEventListener('scroll', handleScroll, { passive: true })\r\n\r\n    return () => {\r\n      window.removeEventListener('scroll', handleScroll)\r\n\r\n      if (throttleTimeout) {\r\n        clearTimeout(throttleTimeout)\r\n      }\r\n    }\r\n  }, deps)\r\n}\r\n\r\nuseScrollPosition.defaultProps = {\r\n  deps: [],\r\n  element: false,\r\n  useWindow: false,\r\n  wait: null,\r\n  boundingElement: false\r\n}\r\n","'use strict'\r\n\r\nimport { keys } from 'ramda'\r\nimport { AudioContext, IAnalyserNode, IGainNode, IAudioContext } from 'standardized-audio-context';\r\nimport { CONTEXT_STATE } from '../constants'\r\n\r\nexport const createContext = () => {\r\n  return new AudioContext();\r\n}\r\n\r\n// TODO\r\nexport const createMasterBus = (\r\n  context: AudioContext,\r\n  connections: any[] = []\r\n): IGainNode<IAudioContext> => {\r\n  const gain = context.createGain()\r\n\r\n  gain.connect(context.destination)\r\n  connections.map((connection) => gain.connect(connection))\r\n\r\n  return gain\r\n}\r\n\r\nexport const createAnalyser = (\r\n  context: AudioContext,\r\n  parameters = { fftSize: 64 }\r\n): IAnalyserNode<IAudioContext> => {\r\n  const analyser = context.createAnalyser()\r\n\r\n  keys(parameters).map((key) => (analyser[key] = parameters[key]))\r\n  return analyser\r\n}\r\n\r\nexport const createPanner = (context: IAudioContext) =>\r\n  context.createStereoPanner()\r\n\r\nexport const isAudioParam = (node, parameter) =>\r\n  node[parameter] instanceof AudioParam\r\n\r\nexport const fetchAudioAsArrayBuffer = (url): Promise<ArrayBuffer> =>\r\n  fetch(url, {credentials: 'include'}).then((response) => response.arrayBuffer())\r\n\r\nexport const isContextRunning = (context) =>\r\n  context.state === CONTEXT_STATE.RUNNING\r\n\r\n/**\r\n * @returns {Promise}\r\n */\r\nexport const resumeContext = (context) => context.resume()\r\n","import {keys} from 'ramda';\r\nimport { IAudioContext, IGainNode } from 'standardized-audio-context';\r\nimport {isAudioParam} from './audio';\r\n\r\n\r\nexport const getNodeParamNormalizedValue = node => {\r\n    const {value, maxValue, defaultValue} = node;\r\n\r\n    let resultValue = value;\r\n\r\n    // @TODO: fix it in normal way\r\n    if (defaultValue === 1) {\r\n        resultValue = value / (1 / 100);\r\n    } else {\r\n        resultValue = value / (maxValue / 100);\r\n    }\r\n\r\n    return resultValue;\r\n}\r\n\r\nexport const setNodeParamNormalizedValue = (node, value): AudioParam => {\r\n    const {maxValue, minValue, defaultValue} = node;\r\n    const dividend = defaultValue === 1 ? 1 : maxValue;\r\n    const absoluteValue = value * (dividend / 100);\r\n\r\n    if (absoluteValue < minValue) {\r\n        node.value = minValue;\r\n\r\n        return node;\r\n    }\r\n\r\n    if (absoluteValue > maxValue) {\r\n        node.value = maxValue;\r\n\r\n        return node;\r\n    }\r\n\r\n    node.value = absoluteValue;\r\n\r\n    return node;\r\n}\r\n\r\nexport const setNodeParams = (node, params) => keys(params).forEach(key => {\r\n    if (isAudioParam(node, key)) {\r\n        setNodeParamNormalizedValue(node[key], params[key]);\r\n    } else {\r\n        node[key] = params[key];\r\n    }\r\n\r\n    return node;\r\n});\r\n\r\nexport const connectNodes = (source, destination) =>\r\n    source.connect(destination);\r\n\r\nexport const connectNodesSingle = (source, destination) => {\r\n    source.disconnect();\r\n    connectNodes(source, destination);\r\n};\r\n\r\nexport const createGainNode = (context: IAudioContext, defaultVolume = 1): IGainNode<IAudioContext> => {\r\n    const gain = context.createGain();\r\n    gain.gain.value = defaultVolume;\r\n\r\n    return gain;\r\n};\r\n","import {map} from 'ramda';\r\n\r\nimport {\r\n    getNodeParamNormalizedValue,\r\n} from './node';\r\n\r\nimport {\r\n    PLAYBACK_STATUS,\r\n    FILTER_TYPES,\r\n} from '../constants';\r\n\r\n\r\nconst createReverbEntity = ({id, responses, currentResponse}) => ({\r\n    id,\r\n    name: 'Reverb',\r\n    parameters: [{\r\n        name: 'Response',\r\n        id: 'currentResponse',\r\n        value: currentResponse,\r\n        values: Object.keys(responses),\r\n        type: 'radio',\r\n    }],\r\n});\r\n\r\nconst createDelayEntity = ({id, time, feedback, frequency}) => ({\r\n    id,\r\n    name: 'Delay',\r\n    parameters: [{\r\n        name: 'Time',\r\n        id: 'time',\r\n        value: time,\r\n    }, {\r\n        name: 'Feedback',\r\n        id: 'feedback',\r\n        value: feedback,\r\n    }, {\r\n        name: 'Frequency',\r\n        id: 'frequency',\r\n        value: frequency,\r\n    }],\r\n});\r\n\r\nconst createDistortionEntity = ({id, filterType, frequency, strength}) => ({\r\n    id,\r\n    name: 'Distortion',\r\n    parameters: [{\r\n        name: 'Filter Type',\r\n        id: 'filterType',\r\n        value: filterType,\r\n        values: Object.values(FILTER_TYPES),\r\n        type: 'radio',\r\n    }, {\r\n        name: 'Frequency',\r\n        id: 'frequency',\r\n        value: frequency,\r\n    }, {\r\n        name: 'Strength',\r\n        id: 'strength',\r\n        value: strength,\r\n    }],\r\n});\r\n\r\n\r\nexport const generateIdByTitle = title => title.replace(/[^A-Za-z0-9]+/gi, '').toLowerCase();\r\n\r\nexport const createTrackEntity = ({analyser, id, title, volume, pan, muted, soloed, bypassFX, fx, state}) => {\r\n  return ({\r\n    analyser,\r\n    id,\r\n    title,\r\n    volume,\r\n    pan,\r\n    state,\r\n    isMuted: muted,\r\n    isSolo: soloed,\r\n    isEffectsDisabled: bypassFX,\r\n    send: map(send => getNodeParamNormalizedValue(send.gain), fx),\r\n})};\r\n\r\nexport const createEffectEntity = effect => {\r\n    switch (effect.id) {\r\n        case 'delay':\r\n            return createDelayEntity(effect);\r\n        case 'distortion':\r\n            return createDistortionEntity(effect);\r\n        case 'reverb':\r\n            return createReverbEntity(effect);\r\n        default:\r\n            return null;\r\n    }\r\n};\r\n\r\nexport interface Playback {\r\n  analyser: AnalyserNode\r\n  status: PLAYBACK_STATUS\r\n  currentPosition: number\r\n  duration?: number\r\n  isLooped: boolean\r\n  masterVolume: number\r\n}\r\n\r\nexport const createPlaybackEntity = ({\r\n    analyser,\r\n    status = PLAYBACK_STATUS.NOT_SET,\r\n    currentPosition = 0,\r\n    duration,\r\n    isLooped = false,\r\n    masterVolume = 70\r\n}): Playback => ({\r\n    analyser,\r\n    status,\r\n    currentPosition,\r\n    duration,\r\n    isLooped,\r\n    masterVolume\r\n});\r\n","import { reject, not} from 'ramda';\r\n\r\nimport {\r\n    createEffectEntity,\r\n    createPlaybackEntity,\r\n    createTrackEntity,\r\n} from '../helpers/entities';\r\nimport { Mixer } from '../models/mixer';\r\n\r\n\r\nconst compact = reject(item => not(Boolean(item)));\r\n\r\nexport const createState = (mixdesk: Mixer, hasMasterTrack) => {\r\n    if (typeof window === 'undefined') {\r\n      return null;\r\n    }\r\n\r\n    const tracks = compact(mixdesk.tracks.map(createTrackEntity));\r\n\r\n    const effects = compact(mixdesk.fx.map(createEffectEntity));\r\n\r\n    const playback = createPlaybackEntity({\r\n        analyser: hasMasterTrack ? mixdesk.analyser : false,\r\n        masterVolume: mixdesk.volume,\r\n        duration: Math.max(...mixdesk.tracks.map(track => track.buffer?.duration))\r\n    });\r\n\r\n    return {\r\n        tracks,\r\n        effects,\r\n        playback,\r\n    };\r\n}\r\n\r\n","import { generateIdByTitle } from '../helpers/entities'\r\nimport {\r\n  fetchAudioAsArrayBuffer,\r\n  createPanner,\r\n  createAnalyser\r\n} from '../helpers/audio'\r\nimport {\r\n  IAudioContext,\r\n  IAnalyserNode,\r\n  IStereoPannerNode,\r\n  IGainNode,\r\n  IAudioBufferSourceNode\r\n} from 'standardized-audio-context';\r\nimport {\r\n  connectNodes,\r\n  createGainNode,\r\n  getNodeParamNormalizedValue,\r\n  setNodeParamNormalizedValue\r\n} from '../helpers/node'\r\n\r\nimport { TRACK_STATE } from '../constants'\r\n\r\nclass Track {\r\n  source: IAudioBufferSourceNode<IAudioContext> | null\r\n  title: string\r\n  id: string\r\n  analyser: IAnalyserNode<IAudioContext>\r\n  buffer: AudioBuffer = null\r\n  context: IAudioContext\r\n  pausedAt: number = 0\r\n  startedAt: number = 0\r\n  muted: boolean = false\r\n  soloed: boolean = false\r\n  playing: boolean = false\r\n  hasBeenPlayed: boolean = false\r\n  bypassFX: boolean = false\r\n  previousVolume: number\r\n  state: TRACK_STATE = TRACK_STATE.NOT_SET\r\n  bus: IGainNode<IAudioContext>\r\n  soloBus: IGainNode<IAudioContext>\r\n  fx: any\r\n  loadingState: Promise<this>\r\n  panner: IStereoPannerNode<IAudioContext>\r\n  isFinished: boolean\r\n  isLooped = false\r\n  handleMixerUnsupportedError: (message: string) => void\r\n\r\n  constructor({\r\n    url,\r\n    title,\r\n    context,\r\n    masterBus,\r\n    sends = [],\r\n    volume = 70,\r\n    pan = 50,\r\n    handleMixerUnsupportedError\r\n  }) {\r\n    this.id = generateIdByTitle(title)\r\n    this.handleMixerUnsupportedError = handleMixerUnsupportedError\r\n\r\n    this.title = title\r\n    this.context = context\r\n    this.isFinished = false\r\n\r\n    this.analyser = createAnalyser(this.context)\r\n    this.bus = createGainNode(context)\r\n    this.soloBus = createGainNode(context)\r\n    this.panner = createPanner(context)\r\n\r\n    connectNodes(this.bus, this.panner)\r\n    connectNodes(this.panner, this.analyser)\r\n    connectNodes(this.analyser, this.soloBus)\r\n    connectNodes(this.soloBus, masterBus)\r\n\r\n    this.fx = {}\r\n\r\n    this.volume = volume\r\n    this.pan = pan\r\n\r\n    if (sends.length > 0) {\r\n      this.addFx(sends)\r\n    }\r\n\r\n    this.loadingState = this.load(url)\r\n  }\r\n\r\n  get volume() {\r\n    return getNodeParamNormalizedValue(this.bus.gain)\r\n  }\r\n\r\n  set volume(value) {\r\n    if (this.muted) {\r\n      this.previousVolume = value\r\n    } else {\r\n      setNodeParamNormalizedValue(this.bus.gain, value)\r\n    }\r\n  }\r\n\r\n  get pan() {\r\n    const countAbsoluteValue = (val: number): number => {\r\n      return (val + 100) / 2\r\n    }\r\n    return countAbsoluteValue(getNodeParamNormalizedValue(this.panner.pan))\r\n  }\r\n\r\n  set pan(value) {\r\n    const countAbsoluteValue = (val: number): number => {\r\n      return -100 + val * 2\r\n    }\r\n    setNodeParamNormalizedValue(this.panner.pan, countAbsoluteValue(value))\r\n  }\r\n\r\n  get looped() {\r\n    return this.source.loop\r\n  }\r\n\r\n  set looped(value) {\r\n    this.isLooped = value\r\n    !this.source && this.createSource()\r\n    this.source.loop = value\r\n  }\r\n\r\n  get currentTime() {\r\n    if (this.buffer) {\r\n      return (this.context.currentTime - this.startedAt) % this.buffer.duration\r\n    }\r\n\r\n    return 0\r\n  }\r\n\r\n  toStartPosition(volume = 70, pan = 50) {\r\n    if (this.muted) {\r\n      this.unmute()\r\n    }\r\n    setNodeParamNormalizedValue(this.soloBus.gain, 100)\r\n    this.soloed = false\r\n    this.volume = volume\r\n    this.pan = pan\r\n  }\r\n\r\n  load(url): Promise<this> {\r\n    return fetchAudioAsArrayBuffer(url)\r\n      .catch((e) => {\r\n        throw {\r\n          error: e,\r\n          message: 'Mixer unavailable at this time. Please reach out to support if the issue persists'\r\n        }\r\n      })\r\n      .then((audioBuffer) => {\r\n        return new Promise((resolve, reject) =>\r\n          this.context.decodeAudioData(audioBuffer, resolve, reject)\r\n        )\r\n        .then((decodedAudioData: AudioBuffer) => {\r\n          this.buffer = decodedAudioData\r\n          this.state = TRACK_STATE.READY\r\n          this.createSource()\r\n          return this\r\n        })\r\n        .catch((e) => {\r\n          throw {\r\n            error: e,\r\n            message: \"Unfortunately, your browser doesn't support mixer!\"\r\n          }\r\n        })\r\n      })\r\n\r\n      .catch((error) => {\r\n        this.handleMixerUnsupportedError(error.message)\r\n        this.state = TRACK_STATE.FAILED\r\n        console.log('[ERROR LOADING TRACK]', error, `URL: ${url}`)\r\n        return this\r\n      })\r\n  }\r\n\r\n  createSource() {\r\n    this.source = this.context.createBufferSource()\r\n    this.source.buffer = this.buffer\r\n    this.source.connect(this.bus)\r\n\r\n    // Get back loop when created again\r\n    if (this.isLooped) {\r\n      this.looped = true\r\n    } else {\r\n      this.source.addEventListener('ended', this.onSourceEnded)\r\n    }\r\n  }\r\n\r\n  onSourceEnded = () => {\r\n    this.stop()\r\n  }\r\n\r\n  removeSource() {\r\n    if (this.source) {\r\n      this.source.removeEventListener('ended', this.onSourceEnded)\r\n      this.source.disconnect()\r\n      this.hasBeenPlayed && this.source.stop(0)\r\n      this.source = null\r\n    }\r\n  }\r\n\r\n  play(playPosition) {\r\n    this.hasBeenPlayed = true\r\n    this.isFinished = false\r\n    if (!this.playing) {\r\n      !this.source && this.createSource()\r\n      this.source.start(0, playPosition || this.pausedAt)\r\n      this.startedAt = playPosition\r\n        ? (this.context.currentTime - playPosition) % this.buffer.duration\r\n        : (this.context.currentTime - this.pausedAt) % this.buffer.duration\r\n      this.pausedAt = 0\r\n      this.playing = true\r\n    }\r\n  }\r\n\r\n  playWithOffset(offset = 0) {\r\n    this.play(this.pausedAt + offset > 0 ? this.pausedAt + offset : 0)\r\n  }\r\n\r\n  pause() {\r\n    if (this.playing) {\r\n      const elapsed = (this.context.currentTime - this.startedAt) % this.buffer.duration\r\n      this.removeSource()\r\n      this.playing = false\r\n      this.pausedAt = elapsed\r\n    }\r\n  }\r\n\r\n  setCurrentPosition(requestedSecond) {\r\n    if (this.playing) {\r\n      this.pause()\r\n      this.play(requestedSecond)\r\n    } else {\r\n      this.pausedAt = requestedSecond < 0 ? 0 : requestedSecond\r\n    }\r\n  }\r\n\r\n  fastForward(value = 15) {\r\n    if (this.playing) {\r\n      this.pause()\r\n      this.playWithOffset(value)\r\n    } else {\r\n      this.pausedAt = this.pausedAt + value > 0 ? this.pausedAt + value : 0\r\n    }\r\n  }\r\n\r\n  stop() {\r\n    this.isFinished = true\r\n    this.pause()\r\n  }\r\n\r\n  mute() {\r\n    this.previousVolume = this.volume\r\n    this.volume = 0\r\n    this.muted = true\r\n  }\r\n\r\n  unmute() {\r\n    this.muted = false\r\n    this.volume = this.previousVolume\r\n  }\r\n\r\n  toggleMute() {\r\n    this.muted ? this.unmute() : this.mute()\r\n  }\r\n\r\n  solo() {\r\n    this.soloed = true\r\n    setNodeParamNormalizedValue(this.soloBus.gain, 100)\r\n  }\r\n\r\n  unsolo() {\r\n    this.soloed = false\r\n    setNodeParamNormalizedValue(this.soloBus.gain, 0)\r\n  }\r\n\r\n  resetSolo() {\r\n    setNodeParamNormalizedValue(this.soloBus.gain, 100)\r\n  }\r\n\r\n  toggleSolo() {\r\n    this.soloed ? this.unsolo() : this.solo()\r\n  }\r\n\r\n  addFx(effects) {\r\n    return effects.map((fx) => {\r\n      const { id, signalIn } = fx\r\n      const bus = createGainNode(this.context, 0)\r\n\r\n      if (this.fx[id]) {\r\n        return false\r\n      }\r\n\r\n      connectNodes(this.bus, bus)\r\n      connectNodes(bus, signalIn)\r\n\r\n      this.fx[id] = bus\r\n\r\n      return bus\r\n    })\r\n  }\r\n\r\n  removeFx(id) {\r\n    this.fx[id].disconnect()\r\n  }\r\n\r\n  toggleFX() {\r\n    const keys = Object.keys(this.fx)\r\n\r\n    this.bypassFX\r\n      ? keys.map(\r\n          (fxId) => (this.fx[fxId].gain.value = this.fx[fxId].previousVolume)\r\n        )\r\n      : keys.map((fxId) => {\r\n          this.fx[fxId].previousVolume = this.fx[fxId].gain.value\r\n          this.fx[fxId].gain.value = 0\r\n        })\r\n\r\n    this.bypassFX = !this.bypassFX\r\n\r\n    return this.bypassFX\r\n  }\r\n}\r\n\r\nexport default Track\r\n","import {\r\n  createContext,\r\n  createAnalyser,\r\n  createMasterBus,\r\n  isContextRunning,\r\n  resumeContext\r\n} from '../helpers/audio'\r\nimport {\r\n  setNodeParams,\r\n  setNodeParamNormalizedValue,\r\n  getNodeParamNormalizedValue\r\n} from '../helpers/node'\r\nimport { playAll, pauseAll, rewindAll, stopAll } from '../helpers/playback'\r\nimport Track from './track'\r\nimport { FX } from './fx'\r\nimport { IAudioContext, IAnalyserNode, IGainNode } from 'standardized-audio-context';\r\n\r\nexport class Mixer {\r\n  context: IAudioContext\r\n  analyser: IAnalyserNode<IAudioContext>\r\n  tracks: Track[]\r\n  commonTracks: Track[]\r\n  // TODO: rename fx to sends?\r\n  fx: FX[]\r\n  masterBus: IGainNode<IAudioContext>\r\n  handleMixerUnsupportedError: () => void\r\n\r\n  constructor(sources = [], effects = [], handleMixerUnsupportedError) {\r\n    if (typeof window !== 'undefined') {\r\n      this.context = createContext()\r\n      this.analyser = createAnalyser(this.context)\r\n      this.masterBus = createMasterBus(this.context, [this.analyser])\r\n      this.tracks = []\r\n      this.handleMixerUnsupportedError = handleMixerUnsupportedError\r\n\r\n      // TODO it proper\r\n      this.volume = 100\r\n\r\n      this.fx = effects.map(\r\n        (Effect) => new Effect(this.context, this.masterBus)\r\n      )\r\n\r\n      this.loadCommonTrack(sources)\r\n    }\r\n  }\r\n\r\n  getFirstTrackProperty(propName, defaultValue) {\r\n    return this.tracks[0] ? this.tracks[0][propName] : defaultValue;\r\n  }\r\n\r\n  get volume(): number {\r\n    return getNodeParamNormalizedValue(this.masterBus.gain)\r\n  }\r\n\r\n  set volume(value) {\r\n    setNodeParamNormalizedValue(this.masterBus.gain, value)\r\n  }\r\n\r\n  get duration(): number {\r\n    return Math.max(...this.tracks.map(track => track.buffer?.duration))\r\n  }\r\n\r\n  get currentTime(): number {\r\n    return this.getFirstTrackProperty(\"currentTime\", 0)\r\n  }\r\n\r\n  get isFinished(): boolean {\r\n    return this.getFirstTrackProperty(\"isFinished\", false)\r\n  }\r\n\r\n  get isLooped(): boolean {\r\n    return this.getFirstTrackProperty(\"isLooped\", false)\r\n  }\r\n\r\n  async setCurrentPosition(value) {\r\n    return this.tracks.map((track: Track) => {\r\n      track.setCurrentPosition(value)\r\n\r\n      return track\r\n    })\r\n  }\r\n\r\n  async fastForward(value = 15) {\r\n    return this.tracks.map((track: Track) => {\r\n      track.fastForward(value)\r\n\r\n      return track\r\n    })\r\n  }\r\n\r\n  async fastRewind(value = 15) {\r\n    return this.fastForward(-value)\r\n  }\r\n\r\n  /**\r\n   * @returns {Promise<Mixer>}\r\n   */\r\n  async play() {\r\n    const { context } = this\r\n\r\n    if (isContextRunning(context) === false) {\r\n      await resumeContext(context)\r\n    }\r\n\r\n    playAll(this.tracks)\r\n    await context.resume()\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * @returns {Promise<Mixer>}\r\n   */\r\n  async pause() {\r\n    pauseAll(this.tracks)\r\n\r\n    await this.context.suspend()\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * @returns {Promise<Mixer>}\r\n   */\r\n  async rewind() {\r\n    rewindAll(this.tracks)\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * @returns {Promise<Mixer>}\r\n   */\r\n  async stop() {\r\n    pauseAll(this.tracks)\r\n    stopAll(this.tracks)\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * @param {TrackId} trackId\r\n   * @param {number} volume\r\n   * @returns {Promise<Track[]>}\r\n   */\r\n  async setTrackVolume(trackId, volume) {\r\n    return this.tracks.map((track: Track) => {\r\n      if (track.id === trackId) {\r\n        track.volume = volume\r\n      }\r\n\r\n      return track\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @param {TrackId} trackId\r\n   * @param {number} volume\r\n   * @returns {Promise<Track[]>}\r\n   */\r\n  async setTrackPan(trackId, pan) {\r\n    return this.tracks.map((track: Track) => {\r\n      if (track.id === trackId) {\r\n        track.pan = pan\r\n      }\r\n\r\n      return track\r\n    })\r\n  }\r\n  /**\r\n   *\r\n   * @param {TrackId} trackId\r\n   * @param {SendId} sendId\r\n   * @param {number} level\r\n   * @returns {Promise<Track[]>}\r\n   */\r\n  async setTrackSendLevel(trackId, sendId, level) {\r\n    return this.tracks.map((track: Track) => {\r\n      if (track.id === trackId) {\r\n        setNodeParamNormalizedValue(track.fx[sendId].gain, level)\r\n      }\r\n\r\n      return track\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @param {TrackId} trackId\r\n   * @param {number} value\r\n   * @returns {Promise<Track[]>}\r\n   */\r\n  async setTrackPanLevel(trackId, value) {\r\n    return this.tracks.map((track: Track) => {\r\n      if (track.id === trackId) {\r\n        track.pan = value\r\n      }\r\n\r\n      return track\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @param {TrackId} trackId\r\n   * @returns {Promise<Track[]>}\r\n   */\r\n  async soloTrack(trackId) {\r\n    const newTracks = this.tracks.map((track: Track) => {\r\n      if (track.id === trackId) {\r\n        track.toggleSolo()\r\n        if (track.muted) {\r\n          track.unmute()\r\n        }\r\n      } else {\r\n        if (!track.soloed) {\r\n          track.unsolo()\r\n        }\r\n      }\r\n      return track\r\n    })\r\n\r\n    if (newTracks.every((track: Track) => !track.soloed)) {\r\n      newTracks.forEach((track: Track) => track.resetSolo())\r\n    }\r\n\r\n    return newTracks\r\n  }\r\n\r\n  /**\r\n   * @param {TrackId} trackId\r\n   * @returns {Promise<Track[]>}\r\n   */\r\n  async toggleTrack(trackId) {\r\n    return this.tracks.map((track: Track) => {\r\n      if (track.id === trackId) {\r\n        track.toggleMute()\r\n      }\r\n\r\n      return track\r\n    })\r\n  }\r\n\r\n  /**\r\n   * @param {TrackId} trackId\r\n   * @returns {Promise<Track[]>}\r\n   */\r\n  async toggleTrackFx(trackId) {\r\n    return this.tracks.map((track: Track) => {\r\n      if (track.id === trackId) {\r\n        track.toggleFX()\r\n      }\r\n\r\n      return track\r\n    })\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {SendId} sendId\r\n   * @param {number|string} value\r\n   * @retruns {Promise<Send[]>}\r\n   */\r\n  async setSendParamValue(sendId, parameterId, value) {\r\n    return this.fx.map((fx) => {\r\n      if (fx.id === sendId) {\r\n        setNodeParams(fx, { [parameterId]: value })\r\n      }\r\n\r\n      return fx\r\n    })\r\n  }\r\n\r\n  async loop(value) {\r\n    return this.tracks.map((track: Track) => {\r\n      track.looped = value\r\n      return track\r\n    })\r\n  }\r\n\r\n  async loadCommonTrack(sources) {\r\n    this.commonTracks = sources.map(\r\n      ({ url, title }) =>\r\n        new Track({\r\n          url,\r\n          title,\r\n          context: this.context,\r\n          masterBus: this.masterBus,\r\n          sends: this.fx,\r\n          handleMixerUnsupportedError: this.handleMixerUnsupportedError\r\n        })\r\n    )\r\n  }\r\n\r\n  async load(sources, callback?) {\r\n    this.commonTracks.forEach((track) => track.toStartPosition())\r\n    this.tracks = [ ...(this.commonTracks || []), ...sources.map(\r\n      ({ url, title }) =>\r\n        new Track({\r\n          url,\r\n          title,\r\n          context: this.context,\r\n          masterBus: this.masterBus,\r\n          sends: this.fx,\r\n          handleMixerUnsupportedError: this.handleMixerUnsupportedError\r\n        })\r\n    )]\r\n\r\n\r\n    const tracksLength = this.tracks.length\r\n    let trackCounter = 1;\r\n    return Promise.all(\r\n      this.tracks.map((track: Track) =>\r\n        track.loadingState.then((chunk) => {\r\n          const current = trackCounter++\r\n          callback({\r\n            length: tracksLength,\r\n            current: current,\r\n            progress: Math.floor(current / tracksLength * 100),\r\n            isLoading: true\r\n          })\r\n          return chunk\r\n        })\r\n      )\r\n    )\r\n  }\r\n}\r\n","import { atom, selector } from 'recoil'\r\n\r\nexport const effectsState = atom({\r\n  key: 'effectsState',\r\n  default: []\r\n})\r\n\r\nexport const tracksState = atom({\r\n  key: 'tracksState',\r\n  default: []\r\n})\r\n\r\nexport const isSoloSelector = selector({\r\n  key: 'isSoloSelector',\r\n  get: ({ get }) => {\r\n    const tracks = get(tracksState)\r\n\r\n    return tracks.some(track => track.isSolo)\r\n  }\r\n})\r\n\r\nexport const mxState = atom({\r\n  key: 'mxState',\r\n  default: {\r\n    current: {\r\n      isLooped: false,\r\n      isFinished: false,\r\n      currentTime: 0,\r\n      rewind: () => {\r\n      },\r\n      play: () => {\r\n      },\r\n      pause: () => {\r\n      },\r\n      fastForward: (value) => value,\r\n      fastRewind: (value) => value,\r\n      setCurrentPosition: (value) => value,\r\n      loop: (value) => value,\r\n      volume: (value) => value\r\n    }\r\n  }\r\n})\r\n\r\nexport const loadingState = atom({\r\n  key: 'loadingState',\r\n  default: {}\r\n})\r\n","import { useRef, useEffect } from 'react'\r\nimport { createState } from '../store/helpers'\r\nimport { Mixer } from '../models/mixer'\r\nimport { FX } from '../models/fx/fx-base'\r\nimport { Playback } from '../helpers/entities'\r\nimport { useSetRecoilState } from 'recoil'\r\nimport { effectsState, tracksState } from '../store/store'\r\nimport {\r\n  analyserState,\r\n  currentPositionState,\r\n  durationState,\r\n  isLoopedState,\r\n  masterVolumeState,\r\n  statusState\r\n} from '../store/playback'\r\n\r\nexport interface MixerTrack {\r\n  url: string\r\n  title: string\r\n}\r\n\r\nexport interface MixerState {\r\n  tracks: MixerTrack[]\r\n  effects: FX[]\r\n  playback: Playback\r\n  loadingState?: () => MixerLoadingState\r\n}\r\n\r\nexport interface MixerLoadingState {\r\n  length: number\r\n  current: number\r\n  progress: number\r\n  isLoading: boolean\r\n}\r\n\r\nexport interface UseMixerHook {\r\n  mx: {\r\n    current?: Mixer\r\n  }\r\n  state: MixerState\r\n  dispatch: React.Dispatch<any>\r\n}\r\n\r\nexport const useMixer = (\r\n    commonTracks,\r\n    tracks,\r\n    effects, \r\n    hasMasterTrack, \r\n    onLoading, \r\n    setIsReady, \r\n    handleMixerUnsupportedError\r\n  ) => {\r\n  const mx = useRef<any>()\r\n\r\n  const setTracks = useSetRecoilState(tracksState)\r\n  const setEffects = useSetRecoilState(effectsState)\r\n\r\n  const setAnalyser = useSetRecoilState(analyserState)\r\n  const setStatus = useSetRecoilState(statusState)\r\n  const setCurrentPosition = useSetRecoilState(currentPositionState)\r\n  const setDuration = useSetRecoilState(durationState)\r\n  const setIsLooped = useSetRecoilState(isLoopedState)\r\n  const setMasterVolume = useSetRecoilState(masterVolumeState)\r\n\r\n  useEffect(() => {\r\n    setIsReady(false)\r\n    const onLoad = async () => {\r\n      const { tracks, effects, playback } = createState(\r\n        mx.current,\r\n        hasMasterTrack\r\n      )\r\n\r\n      mx.current.setCurrentPosition(0)\r\n\r\n      await setTracks(tracks)\r\n      await setEffects(effects)\r\n      await setStatus('READY')\r\n      await setAnalyser(playback.analyser)\r\n      await setCurrentPosition(0)\r\n      await setDuration(playback.duration)\r\n      await setIsLooped(playback.isLooped)\r\n      await setMasterVolume(playback.masterVolume)\r\n\r\n      setIsReady(true)\r\n      onLoading({\r\n        length: tracks.length,\r\n        current: tracks.length,\r\n        isLoading: false\r\n      })\r\n    }\r\n\r\n    if (!mx.current) {\r\n      mx.current = new Mixer(commonTracks, effects, handleMixerUnsupportedError)\r\n    }\r\n\r\n    mx.current\r\n      .stop()\r\n      .then(() => mx.current.load(tracks, onLoading, handleMixerUnsupportedError))\r\n      .then(onLoad)\r\n\r\n  }, [ tracks ])\r\n\r\n  return mx\r\n}\r\n","import { useEffect } from 'react'\r\nimport { PLAYBACK_STATUS } from '../constants'\r\nimport { useRecoilState, useSetRecoilState } from 'recoil'\r\nimport { currentPositionState, statusState } from '../store/playback'\r\n\r\nexport const useProgress = (mx: any) => {\r\n\r\n  const [status, setStatus] = useRecoilState(statusState)\r\n  const setCurrentPosition = useSetRecoilState(currentPositionState)\r\n\r\n  useEffect(() => {\r\n    let interval\r\n\r\n    switch (status) {\r\n      case PLAYBACK_STATUS.PLAYING:\r\n        interval = setInterval(() => {\r\n          setCurrentPosition(mx.current.currentTime)\r\n          if (mx.current.isLooped && mx.current.isFinished) {\r\n            setCurrentPosition(0)\r\n          } else if (mx.current.isFinished) {\r\n            setStatus('PAUSED')\r\n            setCurrentPosition(0)\r\n          } else {\r\n            setCurrentPosition(mx.current.currentTime)\r\n          }\r\n        }, 1000)\r\n        return () => clearInterval(interval)\r\n      default:\r\n        return () => clearInterval(interval)\r\n    }\r\n  }, [status])\r\n}\r\n","import React, { useContext } from 'react'\r\nimport { UserInputEvent, MixerChanges } from \"../containers\"\r\n\r\ninterface MxContextInterface {\r\n  mx: any\r\n  isReady: boolean\r\n  mixerChanges: MixerChanges\r\n  onUserInput: (event: UserInputEvent) => void\r\n}\r\n\r\nexport const MxContext = React.createContext<MxContextInterface>({\r\n  mx: null,\r\n  isReady: false,\r\n  mixerChanges: null,\r\n  onUserInput: (event: UserInputEvent) => {event}\r\n})\r\n\r\nexport const MxContextProvider: React.FC<MxContextInterface> = ({\r\n    mx,\r\n    isReady,\r\n    mixerChanges,\r\n    onUserInput,\r\n    children\r\n  }) => {\r\n  return (\r\n    <MxContext.Provider\r\n      value={{\r\n        mx,\r\n        isReady,\r\n        mixerChanges,\r\n        onUserInput\r\n      }}\r\n    >\r\n  {children}\r\n  </MxContext.Provider>\r\n  )\r\n}\r\n\r\nconst useMxContext = (): MxContextInterface => {\r\n  return useContext(MxContext)\r\n}\r\n\r\nexport { useMxContext }\r\n","import React, { useEffect, useState } from 'react'\r\nimport { useRecoilValue, useSetRecoilState } from 'recoil'\r\nimport { currentPositionState, progressBarSelector } from '../../../store/playback'\r\nimport style from '../style.module.css'\r\nimport Fader from '../../Fader'\r\nimport { useMxContext } from \"../../../hooks\"\r\n\r\nconst ProgressBar = () => {\r\n  const {mx} = useMxContext()\r\n  const setCurrentPosition = useSetRecoilState(currentPositionState)\r\n\r\n  const onSetCurrentPosition = async (value) => {\r\n    if (mx.current) {\r\n      await mx.current.setCurrentPosition(value)\r\n    }\r\n\r\n    setCurrentPosition(value)\r\n  }\r\n\r\n  const { currentPosition, duration } = useRecoilValue(progressBarSelector);\r\n  const [progressPosition, setProgressPosition] = useState(0)\r\n\r\n  useEffect(() => {\r\n    setProgressPosition(\r\n      persentPassed(currentPosition, duration)\r\n    )\r\n  }, [currentPosition])\r\n\r\n  return (\r\n    <div className={style.progressContainer}>\r\n      <Fader\r\n        className={style.progressBar}\r\n        onChangeEnd={(percent) => {\r\n          onSetCurrentPosition(secondsParsed(percent, duration))\r\n        }}\r\n        onChange={(percent) => {\r\n          setProgressPosition(percent)\r\n        }}\r\n        isKnobThumb\r\n        value={progressPosition}\r\n      />\r\n\r\n      <div className={style.progressTimeNow}>\r\n        {convertTime(currentPosition)}\r\n      </div>\r\n      <div className={style.progressTime}>\r\n        {convertTime(duration)}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default React.memo(ProgressBar)\r\n\r\nconst convertTime = (seconds = 0) => {\r\n  const secondsResult = Math.floor(seconds % 60)\r\n  const result = {\r\n    minutes: Math.floor(((seconds - secondsResult) / 60) % 60),\r\n    seconds: secondsResult >= 10 ? secondsResult : `0${secondsResult}`\r\n  }\r\n  return `${result.minutes}:${result.seconds}`\r\n}\r\n\r\nconst persentPassed = (seconds, duration) => {\r\n  const persent = (100 * seconds) / duration\r\n  return persent >= 100 ? 100 : persent\r\n}\r\n\r\nconst secondsParsed = (percent, duration) => (percent * duration) / 100\r\n","import classnames from 'classnames'\r\nimport style from '../style.module.css'\r\nimport { isPaused, isPlaying } from '../../../helpers'\r\nimport React from 'react'\r\nimport { useRecoilValue, useSetRecoilState } from 'recoil'\r\nimport { currentPositionState, progressBarSelector } from '../../../store/playback'\r\nimport { useMxContext } from \"../../../hooks\"\r\n\r\nconst PlayController = ({isDisabled, status, onPlay, onPause}) => {\r\n  const btnClassNames = (isButtonPressed: boolean) =>\r\n    classnames(\r\n      style.control,\r\n      style.button,\r\n      isButtonPressed && style.isButtonPressed\r\n    )\r\n\r\n  const {mx} = useMxContext()\r\n  const setCurrentPosition = useSetRecoilState(currentPositionState)\r\n\r\n  const { currentPosition, duration } = useRecoilValue(progressBarSelector);\r\n\r\n  const onFastForward = async (value) => {\r\n    if (mx.current) {\r\n      if (currentPosition + value < duration) {\r\n        setCurrentPosition((state) => state + value)\r\n        await mx.current.fastForward(value)\r\n      } else {\r\n        setCurrentPosition(duration)\r\n        await mx.current.fastForward(duration - currentPosition)\r\n      }\r\n    }\r\n  }\r\n\r\n  const onFastRewind = async (value) => {\r\n    if (mx.current) {\r\n      if (currentPosition - value > 0) {\r\n        setCurrentPosition((state) => state - value)\r\n        await mx.current.fastRewind(value)\r\n      } else {\r\n        setCurrentPosition(0)\r\n        await mx.current.fastRewind(currentPosition)\r\n      }\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={style.controlsLeft}>\r\n      <button\r\n        className={style.controlButton}\r\n        disabled={isDisabled}\r\n        onClick={() => onFastRewind(15)}\r\n      >\r\n        <span>15</span>\r\n        <svg\r\n          xmlns='http://www.w3.org/2000/svg'\r\n          viewBox='0 0 24 28'\r\n          width='24px'\r\n        >\r\n          <path\r\n            fill='#fff'\r\n            d='M12.4 4V.5a.4.4 0 00-.8-.3L7.5 4.3a1 1 0 000 1.4l4.1 4.2c.3.3.8 0 .8-.3V6a9.8 9.8 0 11-10 9.8H.6A11.7 11.7 0 1012.4 4z'\r\n          />\r\n        </svg>\r\n      </button>\r\n      {!isPlaying(status) ? (\r\n        <button\r\n          className={btnClassNames(isPlaying(status))}\r\n          onClick={onPlay}\r\n          disabled={isDisabled}\r\n        >\r\n          <svg\r\n            xmlns='http://www.w3.org/2000/svg'\r\n            width='32px'\r\n            viewBox='0 0 32 36'\r\n          >\r\n            <defs />\r\n            <path fill='#fff' d='M31.5 18L.5 36V0z' />\r\n          </svg>\r\n        </button>\r\n      ) : (\r\n        <button\r\n          className={btnClassNames(isPaused(status))}\r\n          onClick={onPause}\r\n          disabled={isDisabled}\r\n        >\r\n          <svg\r\n            width='32px'\r\n            height='36px'\r\n            viewBox='0 0 100 100'\r\n            xmlns='http://www.w3.org/2000/svg'\r\n          >\r\n            <path\r\n              id='svg_1'\r\n              d='m29.05829,98.186882l-18.799027,0c-4.588525,0 -8.308265,-3.719734 -8.308265,-8.308266l0,-79.706622c0,-4.588521 3.71974,-8.308262 8.308265,-8.308262l18.799027,0c4.588522,0 8.308264,3.71974 8.308264,8.308262l0,79.706622c0,4.588531 -3.719742,8.308266 -8.308264,8.308266z'\r\n            />\r\n            <path\r\n              id='svg_2'\r\n              d='m88.74073,98.108856l-18.799034,0c-4.588516,0 -8.308258,-3.719734 -8.308258,-8.308266l0,-79.706615c0,-4.588525 3.719742,-8.308266 8.308258,-8.308266l18.799034,0c4.588531,0 8.308273,3.719741 8.308273,8.308266l0,79.706615c0,4.588531 -3.719742,8.308266 -8.308273,8.308266z'\r\n            />\r\n            <path\r\n              id='svg_3'\r\n              d='m30.498528,2.009229c1.62159,1.516152 2.650631,3.65859 2.650631,6.054068l0,79.706615c0,4.588539 -3.71974,8.308273 -8.30826,8.308273l-18.799028,0c-0.493438,0 -0.970003,-0.063263 -1.440241,-0.1455c1.484523,1.387512 3.464588,2.254196 5.657634,2.254196l18.799027,0c4.588522,0 8.308264,-3.719734 8.308264,-8.308266l0,-79.706622c0,-4.095088 -2.96904,-7.477437 -6.868027,-8.162765z'\r\n            />\r\n            <path\r\n              id='svg_4'\r\n              d='m90.180962,1.93121c1.621582,1.516153 2.65065,3.658586 2.65065,6.054068l0,79.706608c0,4.588539 -3.719742,8.308273 -8.308273,8.308273l-18.799026,0c-0.493439,0 -0.970009,-0.063263 -1.440239,-0.1455c1.484512,1.387535 3.464584,2.254196 5.657623,2.254196l18.799034,0c4.588531,0 8.308273,-3.719734 8.308273,-8.308266l0,-79.706615c0,-4.095092 -2.969055,-7.479549 -6.868042,-8.162765z'\r\n            />\r\n            <path\r\n              id='svg_5'\r\n              fill='none'\r\n              stroke='#000000'\r\n              strokeMiterlimit='10'\r\n              d='m29.05829,98.186882l-18.799027,0c-4.588525,0 -8.308265,-3.719734 -8.308265,-8.308266l0,-79.706622c0,-4.588521 3.71974,-8.308262 8.308265,-8.308262l18.799027,0c4.588522,0 8.308264,3.71974 8.308264,8.308262l0,79.706622c0,4.588531 -3.719742,8.308266 -8.308264,8.308266z'\r\n            />\r\n            <path\r\n              id='svg_6'\r\n              fill='none'\r\n              stroke='#000000'\r\n              strokeMiterlimit='10'\r\n              d='m88.74073,98.108856l-18.799034,0c-4.588516,0 -8.308258,-3.719734 -8.308258,-8.308266l0,-79.706615c0,-4.588525 3.719742,-8.308266 8.308258,-8.308266l18.799034,0c4.588531,0 8.308273,3.719741 8.308273,8.308266l0,79.706615c0,4.588531 -3.719742,8.308266 -8.308273,8.308266z'\r\n            />\r\n          </svg>\r\n        </button>\r\n      )}\r\n      <button\r\n        className={style.controlButton}\r\n        disabled={isDisabled}\r\n        onClick={() => onFastForward(15)}\r\n      >\r\n        <span>15</span>\r\n        <svg\r\n          xmlns='http://www.w3.org/2000/svg'\r\n          width='24px'\r\n          viewBox='0 0 24 28'\r\n        >\r\n          <path\r\n            fill='#fff'\r\n            d='M11.9 4V.5c0-.4.4-.5.7-.3l4.2 4.2a1 1 0 010 1.4L12.6 10a.4.4 0 01-.7-.3V6a9.8 9.8 0 109.9 9.8h1.9A11.7 11.7 0 1111.9 4z'\r\n          />\r\n        </svg>\r\n      </button>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default PlayController\r\n","import { useRecoilValue } from 'recoil'\r\nimport { masterVolumeState } from '../../../store/playback'\r\nimport React, { useMemo } from 'react'\r\nimport style from '../style.module.css'\r\nimport Fader from '../../Fader'\r\n\r\nconst VolumeController = ({onMasterVolumeChange}) => {\r\n  const masterVolume = useRecoilValue(masterVolumeState);\r\n\r\n  const volumeIcon = useMemo(() => {\r\n    if (masterVolume === 0) {\r\n      return (\r\n        <svg\r\n          xmlns='http://www.w3.org/2000/svg'\r\n          width='30'\r\n          height='24'\r\n          viewBox='0 0 30 24'\r\n        >\r\n          <g>\r\n            <g>\r\n              <g>\r\n                <path\r\n                  fill='#fff'\r\n                  d='M16.044 2.959v17.166L6.63 16.342H2V6.743h4.63zM0 4.743v13.599h6.243l11.801 4.742V0L6.243 4.743z'\r\n                />\r\n              </g>\r\n              <g>\r\n                <path\r\n                  fill='#fff'\r\n                  d='M26.291 11.542l2.674-2.674a1 1 0 0 0-1.414-1.414l-2.674 2.674-2.674-2.674a1 1 0 0 0-1.414 1.414l2.674 2.674-2.674 2.674a.999.999 0 1 0 1.414 1.414l2.674-2.674 2.674 2.674a.997.997 0 0 0 1.414 0 1 1 0 0 0 0-1.414z'\r\n                />\r\n              </g>\r\n            </g>\r\n          </g>\r\n        </svg>\r\n      )\r\n    } else if (masterVolume > 0 && masterVolume <= 25) {\r\n      return (\r\n        <svg\r\n          xmlns='http://www.w3.org/2000/svg'\r\n          width='25'\r\n          height='24'\r\n          viewBox='0 0 25 24'\r\n        >\r\n          <g>\r\n            <g>\r\n              <g>\r\n                <path\r\n                  fill='#fff'\r\n                  d='M16.045 2.959v17.166L6.63 16.342H2V6.743h4.63zM0 4.743v13.599h6.243l11.802 4.742V0L6.243 4.743z'\r\n                />\r\n              </g>\r\n              <g>\r\n                <path\r\n                  fill='#fff'\r\n                  d='M22.166 6.628a1 1 0 0 0-1.414 1.414 4.918 4.918 0 0 1 1.451 3.5 4.92 4.92 0 0 1-1.451 3.501.999.999 0 1 0 1.414 1.414 6.903 6.903 0 0 0 2.037-4.915c0-1.855-.724-3.6-2.037-4.914z'\r\n                />\r\n              </g>\r\n            </g>\r\n          </g>\r\n        </svg>\r\n      )\r\n    } else if (masterVolume > 25 && masterVolume <= 75) {\r\n      return (\r\n        <svg\r\n          xmlns='http://www.w3.org/2000/svg'\r\n          width='26'\r\n          height='24'\r\n          viewBox='0 0 26 24'\r\n        >\r\n          <g>\r\n            <g>\r\n              <g>\r\n                <path\r\n                  fill='#fff'\r\n                  d='M16.043 2.959v17.166l-9.414-3.783H2V6.743h4.629zM0 4.743v13.599h6.243l11.8 4.742V0l-11.8 4.743z'\r\n                />\r\n              </g>\r\n              <g>\r\n                <path\r\n                  fill='#fff'\r\n                  d='M22.166 4.319a1 1 0 1 0-1.415 1.414c3.204 3.204 3.204 8.416 0 11.62a1 1 0 0 0 1.415 1.413c3.982-3.983 3.982-10.464 0-14.447z'\r\n                />\r\n              </g>\r\n            </g>\r\n          </g>\r\n        </svg>\r\n      )\r\n    } else {\r\n      return (\r\n        <svg\r\n          xmlns='http://www.w3.org/2000/svg'\r\n          width='30px'\r\n          viewBox='0 0 30 25'\r\n        >\r\n          <defs />\r\n          <path\r\n            fill='#fff'\r\n            d='M16 3.7v17.1l-9.4-3.7H2V7.5h4.6zM0 5.5V19h6.2L18 23.8V.8L6.2 5.4zM22.2 5a1 1 0 10-1.4 1.4 8.2 8.2 0 012.4 5.9 8.2 8.2 0 01-2.4 5.8 1 1 0 101.4 1.4 10.1 10.1 0 003-7.2c0-2.8-1.1-5.3-3-7.3z'\r\n          />\r\n          <path\r\n            fill='#fff'\r\n            d='M24.9.3a1 1 0 00-1.4 1.4 15 15 0 010 21.1 1 1 0 101.4 1.4 17 17 0 000-24z'\r\n          />\r\n        </svg>\r\n      )\r\n    }\r\n  }, [masterVolume])\r\n\r\n  return (\r\n    <div className={style.masterVolumeContainer}>\r\n      <div className={style.masterVolume}>{volumeIcon}</div>\r\n\r\n      <Fader\r\n        onChange={onMasterVolumeChange}\r\n        isKnobThumb\r\n        value={masterVolume}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default VolumeController\r\n","import {converge, divide, sum, length} from 'ramda';\r\n\r\n\r\nconst COLOR_GREEN = '#05860f';\r\nconst COLOR_YELLOW = '#f9ef5c';\r\nconst COLOR_RED = '#861615';\r\n\r\n/**\r\n * @param {AudioContext} context\r\n * @param {Canvas} canvas\r\n * @returns {CanvasGradient}\r\n */\r\nexport const createMeterGradient = (context, {\r\n    width,\r\n    height,\r\n}) => {\r\n    const gradient = context.createLinearGradient(0, 0, width, height);\r\n\r\n    gradient.addColorStop(0.0, COLOR_GREEN);\r\n    gradient.addColorStop(0.8, COLOR_YELLOW);\r\n    gradient.addColorStop(0.9, COLOR_RED);\r\n\r\n    return gradient;\r\n}\r\n\r\nexport const getAverage = converge(divide, [sum, length]);","import React, { useRef, useEffect } from 'react'\r\n\r\nimport { getAverage, createMeterGradient } from './helpers'\r\n\r\nimport style from './style.module.css'\r\nimport trackStyle from './../Track/style.module.css'\r\nimport Fader from '../Fader'\r\nimport { useRecoilValue } from 'recoil'\r\nimport { statusState } from '../../store/playback'\r\n\r\ninterface MasterTrackProps {\r\n  analyser: AnalyserNode\r\n  width?: number\r\n  height?: number\r\n  volume?: number\r\n  onVolumeChange: (value) => void\r\n}\r\n// TODO: remove the master track component and add the isMaster prop to a Track component\r\nconst MasterTrack: React.FC<MasterTrackProps> = ({\r\n  analyser = null,\r\n  width = 6,\r\n  height = 176,\r\n  volume = 70,\r\n  onVolumeChange\r\n}) => {\r\n  if (!analyser) {\r\n    return null\r\n  }\r\n\r\n  const average = useRef(0)\r\n  const status = useRecoilValue(statusState)\r\n  const canvasRef = useRef<HTMLCanvasElement>(null)\r\n\r\n  useEffect(() => {\r\n    let frame\r\n    const context = canvasRef.current && canvasRef.current.getContext('2d')\r\n    const array = new Uint8Array(analyser.frequencyBinCount)\r\n\r\n    const drawMeter = () => {\r\n      analyser.getByteFrequencyData(array)\r\n\r\n      average.current = getAverage(array)\r\n\r\n      if (context) {\r\n        context.clearRect(0, 0, width, height)\r\n        context.fillStyle = createMeterGradient(context as any, {\r\n          width,\r\n          height\r\n        })\r\n        const maxValueToCurrentVolume = height * (volume / 100)\r\n        const progress = (height / 100) * average.current\r\n        context.fillRect(0, 0, width, Math.min(progress, maxValueToCurrentVolume))\r\n      }\r\n      frame = requestAnimationFrame(drawMeter)\r\n    }\r\n\r\n    const toZero = () => {\r\n      if (average.current > 0) {\r\n        average.current -= 2\r\n        context.clearRect(0, 0, width, height)\r\n        context.fillStyle = createMeterGradient(context as any, {\r\n          width,\r\n          height\r\n        })\r\n        context.fillRect(0, 0, width, (height / 100) * average.current)\r\n        frame = requestAnimationFrame(toZero)\r\n      } else {\r\n        cancelAnimationFrame(frame)\r\n      }\r\n    }\r\n\r\n    if  (status === 'PLAYING') {\r\n      frame = requestAnimationFrame(drawMeter)\r\n    } else {\r\n      toZero()\r\n    }\r\n    \r\n    return () => cancelAnimationFrame(frame)\r\n  }, [status, volume])\r\n\r\n  return (\r\n    <div className={`${style.meter} ${trackStyle.track}`}>\r\n      <div className={style.masterTrackIcon}>\r\n        <svg xmlns='http://www.w3.org/2000/svg' width='30' height='25' viewBox='0 0 30 25'>\r\n          <g>\r\n            <g>\r\n              <g>\r\n                <path fill='#fff' d='M.018 25V7.644h5.729V25z' />\r\n              </g>\r\n              <g>\r\n                <path fill='#fff' d='M8.096 25v-9.704h5.729V25z' />\r\n              </g>\r\n              <g>\r\n                <path fill='#fff' d='M16.176 25V.913h5.729V25z' />\r\n              </g>\r\n              <g>\r\n                <path fill='#fff' d='M24.254 25V11.368h5.729V25z' />\r\n              </g>\r\n            </g>\r\n          </g>\r\n        </svg>\r\n      </div>\r\n      <canvas\r\n        className={style.meterValue}\r\n        width={width}\r\n        height={height}\r\n        ref={canvasRef}\r\n      />\r\n\r\n      <Fader onChange={onVolumeChange} isVertical value={volume} />\r\n\r\n      <div className={trackStyle.title}>Master</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MasterTrack\r\n","import {createContext} from 'react';\r\n\r\nexport const Context = createContext(null);\r\n\r\n","'use strict';\r\n\r\nimport {last, head} from 'ramda';\r\nimport {setNodeParams, connectNodes, connectNodesSingle, createGainNode} from '../../helpers/node';\r\nimport { \r\n    IAudioContext, \r\n    IGainNode\r\n} from 'standardized-audio-context';\r\n\r\nexport class FX {\r\n    id: string;\r\n    isLooped: boolean;\r\n    // TODO\r\n    chain: any[];\r\n    context: IAudioContext;\r\n    signalIn: IGainNode<IAudioContext>;\r\n    signalOut: IGainNode<IAudioContext>;\r\n    constructor({id, context, masterBus}) {\r\n        this.id = id;\r\n        this.isLooped = false;\r\n        this.chain = [];\r\n\r\n        this.context = context;\r\n\r\n        this.signalIn = createGainNode(context);\r\n        this.signalOut = createGainNode(context);\r\n\r\n        connectNodes(this.signalOut, masterBus);\r\n    }\r\n\r\n    get isChainEmpty() {\r\n        return this.chain.length === 0;\r\n    }\r\n\r\n    get gain() {\r\n        return this.signalIn.gain.value;\r\n    }\r\n\r\n    set gain(value) {\r\n        this.signalIn.gain.value = value;\r\n    }\r\n\r\n    addNode(node, parameters = {}) {\r\n        setNodeParams(node, parameters);\r\n\r\n        this.isChainEmpty\r\n            ? connectNodes(this.signalIn, node)\r\n            : connectNodesSingle(last(this.chain), node);\r\n\r\n        connectNodes(node, this.signalOut);\r\n\r\n        this.chain.push(node);\r\n    }\r\n\r\n    tweakNode(nodeIndex, parameter, value) {\r\n        const node = this.chain[nodeIndex];\r\n\r\n        if (!node) {\r\n            return false;\r\n        }\r\n\r\n        return setNodeParams(node, {\r\n            [parameter]: value,\r\n        });\r\n    }\r\n\r\n    set loop(value) {\r\n        const lastNode = last(this.chain);\r\n        const firstNode = head(this.chain);\r\n\r\n        connectNodes(lastNode, firstNode);\r\n\r\n        this.isLooped = value;\r\n    }\r\n\r\n    get loop() {\r\n        return this.isLooped;\r\n    }\r\n}\r\n","'use strict';\r\n\r\nimport {\r\n    getNodeParamNormalizedValue,\r\n} from '../../helpers/node';\r\n\r\nimport {FX} from './fx-base';\r\n\r\n\r\nconst DEFAULT_FEEDBACK = 80;\r\nconst DEFAULT_TIME = 25;\r\nconst DEFAULT_FREQUENCY = 5; // 1120 of 20000 in percents\r\n\r\nexport class Delay extends FX {\r\n\r\n    // TODO\r\n    chain: any;\r\n\r\n    constructor(context, masterBus) {\r\n        super({\r\n            context,\r\n            masterBus,\r\n            id: 'delay',\r\n        });\r\n\r\n        this.addNode(context.createDelay(), {\r\n            delayTime: DEFAULT_TIME,\r\n        });\r\n\r\n        this.addNode(context.createGain(), {\r\n            gain: DEFAULT_FEEDBACK,\r\n        });\r\n\r\n        this.addNode(context.createBiquadFilter(), {\r\n            frequency: DEFAULT_FREQUENCY,\r\n        });\r\n\r\n        this.loop = true;\r\n    }\r\n\r\n    set time(value) {\r\n        this.tweakNode(0, 'delayTime', value);\r\n    }\r\n\r\n    get time() {\r\n        return getNodeParamNormalizedValue(this.chain[0].delayTime);\r\n    }\r\n\r\n    set feedback(value) {\r\n        this.tweakNode(1, 'gain', value);\r\n    }\r\n\r\n    get feedback() {\r\n        return getNodeParamNormalizedValue(this.chain[1].gain);\r\n    }\r\n\r\n    set frequency(value) {\r\n        this.tweakNode(2, 'frequency', value);\r\n    }\r\n\r\n    get frequency() {\r\n        return getNodeParamNormalizedValue(this.chain[2].frequency);\r\n    }\r\n}\r\n","'use strict';\r\n\r\nimport {\r\n    getNodeParamNormalizedValue,\r\n} from '../../helpers/node';\r\n\r\nimport {FX} from './fx-base';\r\n\r\nconst STRENGTH_MIN = 0;\r\nconst STRENGTH_MAX = 1000;\r\nconst DEFAULT_STRENGTH = 200;\r\nconst DEFAULT_FILTER_FREQUENCY = 138;\r\nconst DEFAULT_FILTER_TYPE = 'highpass';\r\nconst DEFAULT_FILTER_Q = 1;\r\n\r\nconst strengthToNode = value => ({\r\n    maxValue: STRENGTH_MAX,\r\n    minValue: STRENGTH_MIN,\r\n    value,\r\n});\r\n\r\nexport class Distortion extends FX {\r\n\r\n    private _strength = DEFAULT_STRENGTH;\r\n\r\n    get strength() {\r\n      return getNodeParamNormalizedValue(strengthToNode(this._strength));\r\n    }\r\n    set strength(value) {\r\n        this._strength = value\r\n        this.tweakNode(1, 'curve', this.getCurve(value))\r\n    }\r\n\r\n    set filterType(value) {\r\n      this.tweakNode(0, 'type', value)\r\n    }\r\n\r\n    get filterType() {\r\n        return this.chain[0].type;\r\n    }\r\n\r\n    set frequency(value) {\r\n        this.tweakNode(0, 'frequency', value)\r\n    }\r\n\r\n    get frequency() {\r\n        return getNodeParamNormalizedValue(this.chain[0].frequency);\r\n    }\r\n\r\n\r\n    constructor(context, masterBus) {\r\n        super({\r\n            context,\r\n            masterBus,\r\n            id: 'distortion',\r\n        });\r\n\r\n        this.addNode(context.createBiquadFilter(), {\r\n            type: DEFAULT_FILTER_TYPE,\r\n            frequency: DEFAULT_FILTER_FREQUENCY,\r\n            Q: DEFAULT_FILTER_Q,\r\n        })\r\n\r\n        this.addNode(context.createWaveShaper(), {\r\n            curve: this.getCurve(this._strength),\r\n            oversample: '4x'\r\n        })\r\n    }\r\n\r\n    getCurve(strength) {\r\n        var k = typeof strength === 'number' ? strength : 50,\r\n            n_samples = 44100,\r\n            curve = new Float32Array(n_samples),\r\n            deg = Math.PI / 180,\r\n            i = 0,\r\n            x\r\n\r\n        for (; i < n_samples; ++i) {\r\n            x = i * 2 / n_samples - 1\r\n            curve[i] = (3 + k) * x * 20 * deg / (Math.PI + k * Math.abs(x))\r\n        }\r\n\r\n        return curve\r\n    }\r\n}\r\n","'use strict';\r\n\r\nimport {head, keys} from 'ramda';\r\n\r\nimport {FX} from './fx-base';\r\nimport {fetchAudioAsArrayBuffer} from '../../helpers/audio';\r\n\r\n// TODO: lib assets\r\nconst RESPONSES = {\r\n    'Versatile': 'assets/impulse-1.mp3',\r\n    'Pattan': 'assets/impulse-2.mp3',\r\n    'Style': 'assets/impulse-3.mp3',\r\n};\r\n\r\nexport class Reverb extends FX {\r\n\r\n    responses: typeof RESPONSES;\r\n    // TODO: enum or whatever\r\n    currentResponseId: 'Versatile' | 'Pattan' | 'Style';\r\n\r\n    constructor(context, masterBus, options = {responses: RESPONSES}) {\r\n        super({\r\n            context,\r\n            masterBus,\r\n            id: 'reverb',\r\n        });\r\n\r\n        this.responses = options.responses;\r\n        this.currentResponseId = head(keys(options.responses));\r\n\r\n        this.addNode(context.createConvolver());\r\n        this.loadResponse();\r\n    }\r\n\r\n    get currentResponse() {\r\n        return this.currentResponseId;\r\n    }\r\n\r\n    set currentResponse(responseId) {\r\n        const responseUrl = this.responses[responseId];\r\n\r\n        if (responseUrl) {\r\n            this.currentResponseId = responseId;\r\n\r\n            this.loadResponse();\r\n        }\r\n    }\r\n\r\n    async loadResponse() {\r\n        const url = this.responses[this.currentResponseId];\r\n\r\n        // TODO:\r\n        const arrayBuffer: any =\r\n            await fetchAudioAsArrayBuffer(url)\r\n                .catch(error => console.warn('[ERROR LOADING RESPONSE]', error));\r\n\r\n        if (arrayBuffer.byteLength > 0) {\r\n            const decodedDataPromise = new Promise((resolve, reject) =>\r\n                this.context.decodeAudioData(arrayBuffer, resolve, reject));\r\n\r\n            this.tweakNode(0, 'buffer', await decodedDataPromise);\r\n        } else {\r\n            console.warn('[ERROR LOADING RESPONSE] arrayBuffer is empty');\r\n        }\r\n    }\r\n}\r\n","import React, { useEffect, useState } from 'react'\r\n\r\nimport { useMixer, MixerLoadingState } from '../../hooks/useMixer'\r\nimport { useProgress } from '../../hooks/useProgress'\r\nimport { DeskContainer } from '../Desk'\r\nimport { Delay, Reverb, Distortion, FX } from '../../models/fx'\r\nimport { RecoilRoot, useRecoilValue } from 'recoil'\r\nimport { statusState } from '../../store/playback'\r\nimport { MxContextProvider } from \"../../hooks\"\r\n\r\ninterface TrackType {\r\n  title: string\r\n  url: string\r\n}\r\n\r\nexport enum UserInputEvents {\r\n  masterVolumeChange = 'masterVolumeChange',\r\n  trackVolumeChange = 'trackVolumeChange',\r\n  panChange = 'panChange',\r\n  playingStateChange = 'playingStateChange',\r\n  onRepeat = 'onRepeat',\r\n}\r\n\r\nexport interface UserInputEvent {\r\n  type: UserInputEvents\r\n  value: string | bigint\r\n  trackId?: string\r\n}\r\n\r\nexport interface MixerChanges {\r\n  masterVolume?: number\r\n  repeat?: boolean\r\n  songKey?: string\r\n  tracks?: {\r\n    [trackId: string]: {\r\n      volume?: number\r\n      pan?: number\r\n      playingState?: string | null\r\n    }\r\n  }\r\n}\r\n\r\nexport interface MixdeskProps  {\r\n  commonTracks: Array<TrackType>\r\n  tracks: Array<TrackType>\r\n  effects: FX[]\r\n  hasMasterTrack?: boolean\r\n  onLoading?: (loadingState: MixerLoadingState) => void\r\n  stopAudio: boolean,\r\n  setMixerIsPlaying: (boolean) => void\r\n  songKey: string\r\n  songId: string\r\n  mixerChanges: MixerChanges\r\n  handleMixerUnsupportedError: () => void\r\n  onUserInput: (event: UserInputEvent) => void\r\n  addMixerCountPlay?: () => void\r\n  isRouteChanged?: boolean\r\n}\r\n\r\nconst Mixer: React.FC<MixdeskProps> = ({\r\n  commonTracks,\r\n  tracks = [],\r\n  effects = [Delay, Reverb, Distortion],\r\n  hasMasterTrack = true,\r\n  onLoading = () => {},\r\n  children,\r\n  stopAudio,\r\n  setMixerIsPlaying,\r\n  songKey,\r\n  mixerChanges,\r\n  handleMixerUnsupportedError,\r\n  onUserInput,\r\n  addMixerCountPlay = () => {},\r\n  isRouteChanged,\r\n}) => {\r\n  const [isReady, setIsReady] = useState(false)\r\n  const mx = useMixer(\r\n    commonTracks,\r\n    tracks,\r\n    effects,\r\n    hasMasterTrack,\r\n    onLoading,\r\n    setIsReady,\r\n    handleMixerUnsupportedError\r\n  )\r\n  const [isFirstPlay, setIsFirstPlay] = useState(true)\r\n  const [alreadyPlayedKeys, setAlreadyPlayedKeys] = useState([])\r\n\r\n  useProgress(mx)\r\n\r\n  const status = useRecoilValue(statusState)\r\n\r\n  const onPause = async () => {\r\n    if (mx.current) {\r\n      await mx.current.pause()\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    isRouteChanged && onPause()\r\n  }, [isRouteChanged])\r\n\r\n  useEffect(() => {\r\n    setIsFirstPlay(true)\r\n  }, [tracks])\r\n\r\n  useEffect(() => {\r\n    if (status === 'PLAYING'){\r\n      if (isFirstPlay && !alreadyPlayedKeys.includes(songKey)) {\r\n        setIsFirstPlay(false)\r\n        setAlreadyPlayedKeys((state) => [...state, songKey])\r\n        addMixerCountPlay()\r\n      }\r\n      setMixerIsPlaying(true)\r\n    } else if (status === 'PAUSED') {\r\n      setMixerIsPlaying(false)\r\n    }\r\n  }, [status])\r\n\r\n  return (\r\n    <MxContextProvider mx={ mx } isReady={ isReady } mixerChanges={mixerChanges} onUserInput={onUserInput} >\r\n      <DeskContainer stopAudio={stopAudio}>\r\n        {children && children}\r\n      </DeskContainer>\r\n    </MxContextProvider>\r\n  )\r\n}\r\n\r\nexport const Mixdesk = (props) => (\r\n  <RecoilRoot>\r\n    <Mixer {...props}/>\r\n  </RecoilRoot>\r\n);\r\n","import React, { useEffect } from 'react'\r\n\r\nimport Desk from './../../components/Desk'\r\n\r\nimport { useSetRecoilState } from 'recoil'\r\nimport {\r\n  isLoopedState,\r\n  masterVolumeState,\r\n  statusState\r\n} from '../../store/playback'\r\nimport { useMxContext } from \"../../hooks\"\r\nimport { UserInputEvents } from \"../Mixdesk\"\r\n\r\n// TODO: add types\r\nexport const DeskContainer: React.FC<{stopAudio: boolean}> = ({ stopAudio, children }) => {\r\n  const {mx, isReady, mixerChanges, onUserInput} = useMxContext()\r\n\r\n  const setStatus = useSetRecoilState(statusState)\r\n  const setIsLooped = useSetRecoilState(isLoopedState)\r\n  const setMasterVolume = useSetRecoilState(masterVolumeState)\r\n\r\n  const onPlay = async () => {\r\n    if (mx.current) {\r\n      await mx.current.play()\r\n    }\r\n\r\n    setStatus('PLAYING')\r\n  }\r\n\r\n  const onPause = async () => {\r\n    if (mx.current) {\r\n      await mx.current.pause()\r\n    }\r\n\r\n    setStatus('PAUSED')\r\n  }\r\n\r\n  const onLoop = async (value) => {\r\n    if (mx.current) {\r\n      await mx.current.loop(value)\r\n    }\r\n\r\n    setIsLooped(value)\r\n    onUserInput({type: UserInputEvents.onRepeat, value: value})\r\n  }\r\n\r\n  const onSetMasterVolume = async (value) => {\r\n    if (mx.current) {\r\n      mx.current.volume = value\r\n    }\r\n\r\n    setMasterVolume(value)\r\n    onUserInput({type: UserInputEvents.masterVolumeChange, value: value})\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (mixerChanges.masterVolume && isReady) {\r\n      onSetMasterVolume(mixerChanges.masterVolume)\r\n    }\r\n  }, [isReady])\r\n\r\n  useEffect(() => {\r\n    if (mixerChanges.repeat && isReady) {\r\n      onLoop(mixerChanges.repeat)\r\n    }\r\n  }, [isReady])\r\n\r\n  useEffect(() => {\r\n    if (stopAudio) {\r\n      onPause()\r\n    }\r\n  }, [stopAudio])\r\n\r\n  return (\r\n    <Desk\r\n      onPlay={onPlay}\r\n      onPause={onPause}\r\n      onLoop={onLoop}\r\n      onMasterVolumeChange={onSetMasterVolume}\r\n    >\r\n      {children}\r\n    </Desk>\r\n  )\r\n}\r\n","import React from 'react';\r\nimport classnames from 'classnames';\r\n\r\nimport style from './style.module.css';\r\n\r\n\r\nconst Radio = ({\r\n    name,\r\n    value: currentValue,\r\n    values = [],\r\n    onChange = () => {},\r\n}) => (\r\n    <div className={style.radio}>\r\n        {values && values.map(value => (\r\n            <div\r\n                key={value}\r\n                className={style.label}\r\n                onClick={() => onChange(value)}\r\n            >\r\n                <div className={classnames(style.control, (value === currentValue) && style.isSelected)} />\r\n                <div className={style.title}>{value}</div>\r\n            </div>\r\n        ))}\r\n    </div>\r\n);\r\n\r\nexport default Radio;\r\n","import React from 'react'\r\n\r\nimport Fader from './../Fader'\r\nimport Radio from './../Radio'\r\n\r\nimport style from './style.module.css'\r\n\r\nconst EffectParameterMap = {\r\n  fader: Fader,\r\n  radio: Radio\r\n}\r\n\r\nconst getControlByType = (type) => EffectParameterMap[type]\r\n\r\nexport type EffectParameterType = 'fader' | 'radio'\r\n\r\nexport interface EffectParameterProps {\r\n  id: string\r\n  name: string\r\n  type: EffectParameterType\r\n  onChange: (id) => void\r\n}\r\n\r\nconst EffectParameter: React.FC<EffectParameterProps> = ({\r\n  onChange,\r\n  ...props\r\n}) => {\r\n  const { id, name, type = 'fader' } = props\r\n\r\n  const Control = getControlByType(type)\r\n\r\n  return Control ? (\r\n    <div className={style.parameter} key={id}>\r\n      <span className={style.title}>{name}:</span>\r\n      <div className={style.controlContainer}>\r\n        <Control {...props} onChange={onChange(id)} />\r\n      </div>\r\n    </div>\r\n  ) : null\r\n}\r\n\r\nexport default EffectParameter\r\n","import React from 'react'\r\n\r\nimport EffectParameter, { EffectParameterProps } from '../EffectParameter'\r\n\r\nimport style from './style.module.css'\r\n\r\ninterface Effect {\r\n  name: string\r\n  parameters: EffectParameterProps[]\r\n  onParamChange: () => void\r\n}\r\n\r\nconst Effect = ({\r\n  name = 'Untitled',\r\n  parameters,\r\n  onParamChange = () => {}\r\n}) => {\r\n  return (\r\n    <div className={style.effect}>\r\n      <div className={style.title}>{name}</div>\r\n\r\n      {parameters &&\r\n        parameters.map((parameter) => (\r\n          <div className={style.parameterValue} key={parameter.id}>\r\n            <EffectParameter {...parameter} onChange={onParamChange} />\r\n          </div>\r\n        ))}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Effect\r\n","import React from 'react'\r\n\r\nimport Effect from '../../components/Effect'\r\nimport { useSetRecoilState } from 'recoil'\r\nimport { effectsState } from '../../store/store'\r\nimport { useMxContext } from \"../../hooks\"\r\n\r\nexport const EffectContainer = (props) => {\r\n  const {mx} = useMxContext()\r\n  const setEffects = useSetRecoilState(effectsState)\r\n\r\n  const setSendParamValue = async (parameterId, value) => {\r\n    if (mx.current) {\r\n      await mx.current.setSendParamValue(props.id, parameterId, value)\r\n    }\r\n\r\n    setEffects((effects) => effects.map(effect => {\r\n      if (props.id === effect.id) {\r\n        return {\r\n          ...effect,\r\n          parameters: effect.parameters.map(parameter => {\r\n            if (parameter.id === parameterId) {\r\n              return {\r\n                ...parameter,\r\n                value,\r\n              };\r\n            }\r\n\r\n            return parameter;\r\n          }),\r\n        };\r\n      }\r\n\r\n      return effect;\r\n    }))\r\n\r\n  }\r\n\r\n  return (\r\n    <Effect {...props} onParamChange={setSendParamValue} />\r\n  )\r\n}\r\n","import React, { useMemo } from 'react'\r\nimport style from './style.module.css'\r\n\r\ninterface KnobProps {\r\n  min: number\r\n  max: number\r\n  value: number\r\n  onChange: any\r\n}\r\n\r\nconst Knob = ({ max, min, value, onChange }: KnobProps) => {\r\n  const minDeg = 45\r\n  const maxDeg = 270\r\n  const radius = 200\r\n  const notMoveArea = 15\r\n\r\n  const deg = useMemo(() => (maxDeg / max) * value + minDeg, [value])\r\n\r\n  const onDoubleClick = () => {\r\n    onChange(50)\r\n  }\r\n\r\n\r\n  const startDrag = (event) => {\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n\r\n    const knob = event.target.getBoundingClientRect()\r\n\r\n    const startCoordinate = {\r\n      x: knob.left + knob.width / 2,\r\n      y: knob.top + knob.height / 2\r\n    }\r\n\r\n    const moveHandler = (e) => {\r\n      generateDeg(e.clientX, e.clientY, startCoordinate)\r\n    }\r\n\r\n    document.addEventListener('mousemove', moveHandler)\r\n    document.addEventListener('mouseup', () => {\r\n      document.removeEventListener('mousemove', moveHandler)\r\n    })\r\n  }\r\n\r\n  const generateDeg = (x, y, startXY) => {\r\n    const distanceToStart = ((x - startXY.x) ** 2 + (y - startXY.y) ** 2) ** 0.5\r\n    const currentPositionToStart = {\r\n      x: x - startXY.x,\r\n      y: y - startXY.y\r\n    }\r\n\r\n    if (distanceToStart > notMoveArea) {\r\n      const step = max / radius\r\n      if (currentPositionToStart.x > currentPositionToStart.y) {\r\n        const newValue = value + (distanceToStart - notMoveArea) * step\r\n        onChange(newValue <= max ? newValue : max)\r\n      } else {\r\n        const newValue = value - (distanceToStart - notMoveArea) * step\r\n        onChange(newValue >= min ? newValue : min)\r\n      }\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={style.knob} onDoubleClick={onDoubleClick}>\r\n      <div className={`${style.knob} ${style.outer}`} onMouseDown={startDrag}>\r\n        <div\r\n          className={`${style.knob} ${style.inner}`}\r\n          style={{ transform: 'rotate(' + deg + 'deg)' }}\r\n        >\r\n          <div className={style.grip} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Knob\r\n","import React, { useEffect, useRef, useState } from 'react'\r\nimport classnames from 'classnames'\r\nimport { keys } from 'ramda'\r\n\r\nimport Fader from './../Fader'\r\nimport Knob from '../Knob'\r\n\r\nimport style from './style.module.css'\r\nimport { getAverage } from '../MasterTrack/helpers'\r\nimport { useRecoilValue } from 'recoil'\r\nimport { statusState } from '../../store/playback'\r\n\r\nconst DEFAULT_VOLUME = 70\r\n\r\ninterface TrackProps {\r\n  analyser: AnalyserNode\r\n  id: string\r\n  title: string\r\n  volume: number\r\n  pan: number\r\n  isMuted: boolean\r\n  isSolo: boolean\r\n  isEffectsDisabled: boolean\r\n  // TODO: Types\r\n  fx: any\r\n  onMute: (trackId) => {}\r\n  onSolo: (trackId) => {}\r\n  onBypass: (trackId) => {}\r\n  onVolumeChange: (trackId, volume) => any\r\n  onSendLevelChange?: (trackId, id, value) => void\r\n  onPanChange: (trackId, value) => {}\r\n  hasSolo: boolean\r\n}\r\n\r\nconst Track: React.FC<TrackProps> = (props) => {\r\n  const [soloMutePriority, setSoloMutePriority] = useState('')\r\n\r\n  const setSoloMutePriorityHelper = (value: 's' | 'm') => {\r\n    if (soloMutePriority.includes(value)) {\r\n      setSoloMutePriority(soloMutePriority.replace(value, ''))\r\n    } else if (soloMutePriority.length < 2) {\r\n      setSoloMutePriority(soloMutePriority + value)\r\n    } else {\r\n      setSoloMutePriority(value)\r\n    }\r\n  }\r\n\r\n  const status = useRecoilValue(statusState)\r\n\r\n  const analyserDiv = useRef<HTMLDivElement>()\r\n\r\n  const height = 176\r\n  const array = new Uint8Array(props.analyser.frequencyBinCount)\r\n  props.analyser.getByteFrequencyData(array)\r\n\r\n  const average = useRef(0)\r\n\r\n  let frame\r\n  const drawMeter = () => {\r\n    props.analyser.getByteFrequencyData(array)\r\n    average.current = getAverage(array)\r\n    if (analyserDiv.current && analyserDiv.current.style) {\r\n      const maxValueToCurrentVolume = height * (props.volume / 100)\r\n      const progress = (height / 100) * average.current\r\n      analyserDiv.current.style.height = `${Math.min(progress, maxValueToCurrentVolume)}px`\r\n    }\r\n\r\n    frame = requestAnimationFrame(drawMeter)\r\n  }\r\n\r\n  const toZero = () => {\r\n    if (analyserDiv.current && analyserDiv.current.style) {\r\n      if (average.current > 0) {\r\n        average.current -= 2\r\n        analyserDiv.current.style.height = `${(height / 100) * average.current}px`\r\n        frame = requestAnimationFrame(toZero)\r\n      } else {\r\n        analyserDiv.current.style.height = `${(height / 100) * 0}px`\r\n        cancelAnimationFrame(frame)\r\n      }\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if  (status === 'PLAYING') {\r\n      frame = requestAnimationFrame(drawMeter)\r\n    } else {\r\n      toZero()\r\n    }\r\n    return () => cancelAnimationFrame(frame)\r\n  }, [status, props.volume])\r\n\r\n  return (\r\n    <div className={style.track}>\r\n\r\n      {(!props.hasSolo || props.isSolo) && <div className={style.meterValue} ref={analyserDiv} />}\r\n\r\n      {keys(props.fx).length > 0 && (\r\n        <button\r\n          className={classnames(\r\n            style.button,\r\n            props.isEffectsDisabled && style.isPressed\r\n          )}\r\n          onClick={() => props.onBypass(props.id)}\r\n        >\r\n          Bypass FX\r\n        </button>\r\n      )}\r\n      <div className={style.trackControls}>\r\n        <button\r\n          className={classnames(\r\n            style.button,\r\n            style.soloButton,\r\n            props.isSolo && style.isPressed\r\n          )}\r\n          onClick={() => {\r\n            setSoloMutePriorityHelper('s')\r\n            if (soloMutePriority === 'm') {\r\n              props.onMute(props.id)\r\n              props.onSolo(props.id)\r\n            } else if (soloMutePriority === 'ms') {\r\n              props.onSolo(props.id)\r\n              props.onMute(props.id)\r\n            } else if (soloMutePriority === 'sm') {\r\n              props.onSolo(props.id)\r\n            } else {\r\n              props.onSolo(props.id)\r\n            }\r\n          }}\r\n        >\r\n          S\r\n        </button>\r\n        <div\r\n          className={classnames(\r\n            style.buttonSeparator,\r\n            props.isMuted || props.isSolo ? style.isHidden : ''\r\n          )}\r\n        />\r\n        {!props.hasSolo && (\r\n          <button\r\n            className={classnames(style.button, props.isMuted && style.isPressed)}\r\n            onClick={() => {\r\n              setSoloMutePriorityHelper('m')\r\n              props.onMute(props.id)\r\n            }}\r\n          >\r\n            M\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      <Knob\r\n        min={0}\r\n        max={100}\r\n        value={props.pan}\r\n        onChange={(value) => props.onPanChange(props.id, value)}\r\n      />\r\n\r\n      {keys(props.fx).length > 0 && (\r\n        <div className={style.sends}>\r\n          {keys(props.fx).map((sendId) => (\r\n            <div className={style.send} key={sendId}>\r\n              <span className={style.sendTitle}>{sendId}</span>\r\n              <Fader\r\n                onChange={(value) => props.onSendLevelChange(props.id, sendId, value)}\r\n                value={props.fx[sendId]}\r\n              />\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      <Fader\r\n        onChange={(value) => props.onVolumeChange(props.id, value)}\r\n        value={props.volume}\r\n        onDoubleClick={() => props.onVolumeChange(props.id, DEFAULT_VOLUME)}\r\n        isVertical\r\n      />\r\n\r\n      <div className={style.title}>\r\n        <span className={style.titleText}>{props.title}</span>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nTrack.defaultProps = {\r\n  // TODO: Default track props do not work\r\n  title: 'Untitled',\r\n  volume: DEFAULT_VOLUME,\r\n  isMuted: false,\r\n  isSolo: false,\r\n  isEffectsDisabled: false,\r\n  // TODO: why is it always truthy even though no send is passed\r\n  fx: null,\r\n  onMute: () => null,\r\n  onSolo: () => null,\r\n  onBypass: () => null,\r\n  onVolumeChange: () => null,\r\n  onSendLevelChange: () => null,\r\n  hasSolo: false\r\n} as Partial<TrackProps>\r\n\r\nexport default Track\r\n","import React, {useEffect} from 'react'\r\n\r\nimport Track from '../../components/Track'\r\nimport { useRecoilState, useRecoilValue } from 'recoil'\r\nimport { isSoloSelector, tracksState } from '../../store/store'\r\nimport style from '../../components/Desk/style.module.css'\r\nimport { useMxContext } from \"../../hooks\"\r\nimport { UserInputEvents } from \"../Mixdesk\"\r\n\r\nconst Tracks = () => {\r\n  const [tracks, setTracks ]= useRecoilState(tracksState)\r\n  const hasSolo = useRecoilValue(isSoloSelector)\r\n\r\n  const {mx, isReady, mixerChanges, onUserInput} = useMxContext()\r\n\r\n  const toggleTrackSolo = async (trackId) => {\r\n    if (mx.current) {\r\n      await mx.current.soloTrack(trackId)\r\n    }\r\n\r\n    setTracks((tracks) => tracks.map(track => {\r\n      if (track.id === trackId) {\r\n        onUserInput({type: UserInputEvents.playingStateChange, value: !track.isSolo ? \"solo\" : null, trackId: track.id})\r\n        return {\r\n          ...track,\r\n          isSolo: !track.isSolo,\r\n        };\r\n      }\r\n\r\n      return track\r\n    }))\r\n  }\r\n\r\n  const toggleTrack = async (trackId) => {\r\n    if (mx.current) {\r\n      await mx.current.toggleTrack(trackId)\r\n    }\r\n\r\n    setTracks((tracks) => tracks.map(track => {\r\n      if (track.id === trackId) {\r\n        onUserInput({type: UserInputEvents.playingStateChange, value: !track.isMuted ? \"mute\" : null, trackId: track.id})\r\n        return {\r\n          ...track,\r\n          isMuted: !track.isMuted,\r\n        };\r\n      }\r\n\r\n      return track\r\n    }))\r\n  }\r\n\r\n  const toggleTrackFx = async (trackId) => {\r\n    if (mx.current) {\r\n      await mx.current.toggleTrackFx(trackId)\r\n    }\r\n\r\n    setTracks((tracks) => tracks.map(track => {\r\n      if (track.id === trackId) {\r\n        return {\r\n          ...track,\r\n          isEffectsDisabled: !track.isEffectsDisabled,\r\n        };\r\n      }\r\n\r\n      return track;\r\n    }))\r\n  }\r\n\r\n  const setTrackVolume = async (trackId, value) => {\r\n    if (mx.current) {\r\n      await mx.current.setTrackVolume(trackId, value)\r\n    }\r\n\r\n    setTracks((tracks) => tracks.map(track => {\r\n      if (track.id === trackId) {\r\n        onUserInput({type: UserInputEvents.trackVolumeChange, value: value, trackId: track.id})\r\n        return {\r\n          ...track,\r\n          volume: value,\r\n        };\r\n      }\r\n      return track;\r\n    }))\r\n  }\r\n\r\n  const setTrackSendLevel = async (trackId, fxId, value) => {\r\n    if (mx.current) {\r\n      await mx.current.setTrackSendLevel(trackId, fxId, value)\r\n    }\r\n\r\n    setTracks((tracks) => tracks.map(track => {\r\n      if (track.id === trackId) {\r\n        return {\r\n          ...track,\r\n          send: {\r\n            ...track.send,\r\n            [fxId]: value,\r\n          },\r\n        };\r\n      }\r\n\r\n      return track;\r\n    }))\r\n  }\r\n\r\n  const setTrackPan = async (trackId, value) => {\r\n    if (mx.current) {\r\n      await mx.current.setTrackPan(trackId, value)\r\n    }\r\n\r\n    setTracks((tracks) => tracks.map(track => {\r\n      if (track.id === trackId) {\r\n        onUserInput({type: UserInputEvents.panChange, value: value, trackId: track.id})\r\n        return {\r\n          ...track,\r\n          pan: value,\r\n        };\r\n      }\r\n      return track;\r\n    }))\r\n  }\r\n\r\n  // Loading mixer state between song key changes\r\n  useEffect(() => {\r\n    if (mixerChanges.tracks && isReady) {\r\n      for (const [trackId, track] of Object.entries(mixerChanges.tracks)) {\r\n        if (track?.volume) {\r\n          setTrackVolume(trackId, track.volume)\r\n        }\r\n        if (track?.pan) {\r\n          setTrackPan(trackId, track.pan)\r\n        }\r\n        switch (track?.playingState) {\r\n          case \"mute\":\r\n            toggleTrack(trackId)\r\n            break\r\n          case \"solo\":\r\n            toggleTrackSolo(trackId)\r\n            break\r\n          default:\r\n            break\r\n        }\r\n      }\r\n    }\r\n  }, [mixerChanges.songKey, isReady])\r\n\r\n  return (\r\n    <div className={style.tracks}>\r\n      {isReady && tracks.map((track, index) => (\r\n        <Track\r\n          key={track.id + index}\r\n          {...track}\r\n          hasSolo={hasSolo}\r\n          onSolo={toggleTrackSolo}\r\n          onMute={toggleTrack}\r\n          onBypass={toggleTrackFx}\r\n          onVolumeChange={setTrackVolume}\r\n          onSendLevelChange={setTrackSendLevel}\r\n          onPanChange={setTrackPan}\r\n        />\r\n      ))}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Tracks\r\n","import React, { useEffect, useRef, useState } from 'react'\r\n\r\nimport classnames from 'classnames'\r\n\r\nimport { isNotActive } from './../../helpers/playback'\r\n\r\nimport style from './style.module.css'\r\nimport { useRecoilValue } from 'recoil'\r\nimport {\r\n  analyserState, isLoopedState, masterVolumeState,\r\n  statusState\r\n} from '../../store/playback'\r\nimport ProgressBar from './components/ProgressBar'\r\nimport PlayController from './components/PlayController'\r\nimport VolumeController from './components/VolumeController'\r\nimport MasterTrack from '../MasterTrack'\r\nimport { effectsState } from '../../store/store'\r\nimport { EffectContainer } from '../../containers'\r\nimport Tracks from '../../containers/Track/Tracks'\r\nimport { useMxContext } from '../../hooks'\r\n\r\ninterface DeskProps {\r\n  onPlay: () => void\r\n  onPause: () => void\r\n  onLoop: (value) => void\r\n  onMasterVolumeChange: (value) => void\r\n}\r\n\r\nconst MasterTrackContainer = ({ onMasterVolumeChange, analyser }) => {\r\n  const masterVolume = useRecoilValue(masterVolumeState)\r\n\r\n  return (\r\n    <MasterTrack\r\n      volume={masterVolume}\r\n      onVolumeChange={onMasterVolumeChange}\r\n      analyser={analyser}\r\n    />\r\n  )\r\n}\r\n\r\nconst Effects = () => {\r\n  const effects = useRecoilValue(effectsState)\r\n\r\n  if (!effects.length) return null\r\n\r\n  return (\r\n    <div className={style.effects}>{effects.map((effect) => (\r\n      <EffectContainer {...effect} key={effect.id} />\r\n    ))}</div>\r\n  )\r\n}\r\n\r\nconst Desk: React.FC<DeskProps> = ({\r\n onPlay = () => {},\r\n onPause = () => {},\r\n onMasterVolumeChange = () => {},\r\n onLoop = () => {},\r\n children\r\n}) => {\r\n\r\n  const analyser = useRecoilValue(analyserState)\r\n  const status = useRecoilValue(statusState)\r\n  const isLooped = useRecoilValue(isLoopedState)\r\n  const { isReady } = useMxContext()\r\n\r\n  const isDisabled = isNotActive(status)\r\n\r\n  const loopButtonClassNames = () =>\r\n    classnames(\r\n      style.controlButton, style.loopButton,\r\n      isLooped && style.isActive,\r\n      !isLooped && style.isNotActive\r\n    )\r\n\r\n  const controllerRef = useRef<HTMLDivElement>()\r\n  const [ isControlsContainerFixed, setIsControlsContainerFixed ] = useState(\r\n    false\r\n  )\r\n\r\n  const deskDiv = useRef<HTMLDivElement>()\r\n\r\n  const setFixedClass = () => {\r\n    if (\r\n      !isControlsContainerFixed &&\r\n      controllerRef.current.getBoundingClientRect().top <= 0\r\n    ) {\r\n      setIsControlsContainerFixed(true)\r\n    } else if (!isControlsContainerFixed) {\r\n      setIsControlsContainerFixed(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    document.addEventListener('scroll', setFixedClass)\r\n\r\n    return () => document.removeEventListener('scroll', setFixedClass)\r\n  }, [])\r\n\r\n  return (\r\n    <div className={style.desk} ref={deskDiv}>\r\n      <div className={style.deskContainer}>\r\n        <div className={style.mixerTitle}>\r\n          <h2>\r\n            <svg xmlns='http://www.w3.org/2000/svg' width='30' height='25' viewBox='0 0 30 25'>\r\n              <g>\r\n                <g>\r\n                  <g>\r\n                    <path fill='#fff' d='M.018 25V7.644h5.729V25z' />\r\n                  </g>\r\n                  <g>\r\n                    <path fill='#fff' d='M8.096 25v-9.704h5.729V25z' />\r\n                  </g>\r\n                  <g>\r\n                    <path fill='#fff' d='M16.176 25V.913h5.729V25z' />\r\n                  </g>\r\n                  <g>\r\n                    <path fill='#fff' d='M24.254 25V11.368h5.729V25z' />\r\n                  </g>\r\n                </g>\r\n              </g>\r\n            </svg>\r\n            Audio Mixer\r\n          </h2>\r\n          <p>Create your own mix to practice along with</p>\r\n        </div>\r\n        <Tracks />\r\n        {analyser && (\r\n          <MasterTrackContainer onMasterVolumeChange={onMasterVolumeChange} analyser={analyser} />\r\n        )}\r\n      </div>\r\n\r\n      <div className={style.controlsBlock}>\r\n        {!isReady && <div className={style.controlsContainerDisable} />}\r\n        <div ref={controllerRef} className={style.controlsContainer}>\r\n          <div\r\n            className={classnames(style.controlsWrapper, {\r\n              [style.isFixed]: isControlsContainerFixed\r\n            })}\r\n          >\r\n            <ProgressBar />\r\n            <div className={style.controls}>\r\n              <PlayController\r\n                isDisabled={isDisabled}\r\n                status={status}\r\n                onPlay={onPlay}\r\n                onPause={onPause}\r\n              />\r\n              <div className={style.controlsCustom}>{children}</div>\r\n              <div className={style.controlsRight}>\r\n                <VolumeController onMasterVolumeChange={onMasterVolumeChange} />\r\n\r\n                <button\r\n                  className={loopButtonClassNames()}\r\n                  onClick={() => {\r\n                    onLoop(!isLooped)\r\n                  }}\r\n                  disabled={isDisabled}\r\n                >\r\n                  <svg\r\n                    xmlns='http://www.w3.org/2000/svg'\r\n                    width='31px'\r\n                    viewBox='0 0 31 28'\r\n                  >\r\n                    <defs />\r\n                    <path\r\n                      fill='#fff'\r\n                      d='M28.3 4.4L24 0v3.4H10.4A10.5 10.5 0 002 19.8l1.4-1.4A8.4 8.4 0 012 13.9c0-4.7 3.8-8.5 8.4-8.5H24V9zM2.7 23.2l4.4 4.4v-3.4h13.5a10.5 10.5 0 008.6-16.4l-1.5 1.4a8.4 8.4 0 011.3 4.6c0 4.6-3.7 8.4-8.4 8.4H7.1v-3.4z'\r\n                    />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <Effects />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Desk\r\n"],"names":["PLAYBACK_STATUS","CONTEXT_STATE","TRACK_STATE","FILTER_TYPES","isPlaying","status","PLAYING","isPaused","PAUSED","isReady","READY","isActive","isNotActive","not","playAll","map","track","play","pauseAll","pause","rewindAll","stop","stopAll","analyserState","atom","key","default","statusState","currentPositionState","durationState","isLoopedState","masterVolumeState","progressBarSelector","selector","get","currentPosition","duration","FaderThumb","position","isVertical","events","isKnobThumb","className","styleProperty","stylePropertyValue","React","style","thumb","knobControl","width","getY","event","touches","pageY","getX","pageX","getPointerVerticalPosition","top","bottom","height","value","getPointerHorizontalPosition","left","rightBorder","getCloserToDefaultValue","defaultValue","Number","EVENTS_MAP","mousemove","mouseup","mousedown","isServer","window","hasTouchEventsSupport","getEventNameByFeature","eventName","Fader","onChange","onChangeEnd","onDoubleClick","containerRef","useRef","isDragging","setIsDragging","useState","onMoveStart","preventDefault","document","documentElement","addEventListener","onMove","onMoveEnd","triggerChangeEvent","removeEventListener","timeout","changeCallback","cancelAnimationFrame","requestAnimationFrame","containerElement","current","offset","getBoundingClientRect","x","scrollLeft","y","scrollTop","newValue","thumbEventName","onClick","clientX","offsetLeft","offsetWidth","classnames","fader","isHorisontal","ref","control","isBrowser","zeroPosition","getScrollPosition","scrollX","scrollY","useScrollPosition","effect","deps","wait","throttleTimeout","callBack","currPos","prevPos","useLayoutEffect","undefined","handleScroll","setTimeout","passive","clearTimeout","defaultProps","element","useWindow","boundingElement","createContext","AudioContext","createMasterBus","context","connections","gain","createGain","connect","destination","connection","createAnalyser","parameters","fftSize","analyser","keys","createPanner","createStereoPanner","isAudioParam","node","parameter","AudioParam","fetchAudioAsArrayBuffer","url","fetch","credentials","then","response","arrayBuffer","isContextRunning","state","RUNNING","resumeContext","resume","getNodeParamNormalizedValue","maxValue","resultValue","setNodeParamNormalizedValue","minValue","dividend","absoluteValue","setNodeParams","params","forEach","connectNodes","source","connectNodesSingle","disconnect","createGainNode","defaultVolume","createReverbEntity","id","responses","currentResponse","name","values","Object","type","createDelayEntity","time","feedback","frequency","createDistortionEntity","filterType","strength","generateIdByTitle","title","replace","toLowerCase","createTrackEntity","volume","pan","muted","soloed","bypassFX","fx","isMuted","isSolo","isEffectsDisabled","send","createEffectEntity","createPlaybackEntity","NOT_SET","isLooped","masterVolume","compact","reject","item","Boolean","createState","mixdesk","hasMasterTrack","tracks","effects","playback","Math","max","buffer","Track","constructor","masterBus","sends","handleMixerUnsupportedError","isFinished","bus","soloBus","panner","length","addFx","loadingState","load","previousVolume","countAbsoluteValue","val","looped","loop","createSource","currentTime","startedAt","toStartPosition","unmute","catch","e","error","message","audioBuffer","Promise","resolve","decodeAudioData","decodedAudioData","FAILED","console","log","createBufferSource","onSourceEnded","removeSource","hasBeenPlayed","playPosition","playing","start","pausedAt","playWithOffset","elapsed","setCurrentPosition","requestedSecond","fastForward","mute","toggleMute","solo","unsolo","resetSolo","toggleSolo","signalIn","removeFx","toggleFX","fxId","Mixer","sources","Effect","loadCommonTrack","getFirstTrackProperty","propName","fastRewind","suspend","rewind","setTrackVolume","trackId","setTrackPan","setTrackSendLevel","sendId","level","setTrackPanLevel","soloTrack","newTracks","every","toggleTrack","toggleTrackFx","setSendParamValue","parameterId","commonTracks","callback","tracksLength","trackCounter","all","chunk","progress","floor","isLoading","effectsState","tracksState","isSoloSelector","some","mxState","useMixer","onLoading","setIsReady","mx","setTracks","useSetRecoilState","setEffects","setAnalyser","setStatus","setDuration","setIsLooped","setMasterVolume","useEffect","onLoad","useProgress","useRecoilState","interval","setInterval","clearInterval","MxContext","mixerChanges","onUserInput","MxContextProvider","children","Provider","useMxContext","useContext","ProgressBar","onSetCurrentPosition","useRecoilValue","progressPosition","setProgressPosition","persentPassed","progressContainer","progressBar","percent","secondsParsed","progressTimeNow","convertTime","progressTime","memo","seconds","secondsResult","result","minutes","persent","PlayController","isDisabled","onPlay","onPause","btnClassNames","isButtonPressed","button","onFastForward","onFastRewind","controlsLeft","controlButton","disabled","xmlns","viewBox","fill","d","stroke","strokeMiterlimit","VolumeController","onMasterVolumeChange","volumeIcon","useMemo","masterVolumeContainer","COLOR_GREEN","COLOR_YELLOW","COLOR_RED","createMeterGradient","gradient","createLinearGradient","addColorStop","getAverage","converge","divide","sum","MasterTrack","onVolumeChange","average","canvasRef","frame","getContext","array","Uint8Array","frequencyBinCount","drawMeter","getByteFrequencyData","clearRect","fillStyle","maxValueToCurrentVolume","fillRect","min","toZero","meter","trackStyle","masterTrackIcon","meterValue","Context","FX","chain","signalOut","isChainEmpty","addNode","last","push","tweakNode","nodeIndex","lastNode","firstNode","head","DEFAULT_FEEDBACK","DEFAULT_TIME","DEFAULT_FREQUENCY","Delay","createDelay","delayTime","createBiquadFilter","STRENGTH_MIN","STRENGTH_MAX","DEFAULT_STRENGTH","DEFAULT_FILTER_FREQUENCY","DEFAULT_FILTER_TYPE","DEFAULT_FILTER_Q","strengthToNode","Distortion","Q","createWaveShaper","curve","getCurve","_strength","oversample","k","n_samples","Float32Array","deg","PI","i","abs","RESPONSES","Reverb","options","currentResponseId","createConvolver","loadResponse","responseId","responseUrl","warn","byteLength","decodedDataPromise","UserInputEvents","stopAudio","setMixerIsPlaying","songKey","addMixerCountPlay","isRouteChanged","isFirstPlay","setIsFirstPlay","alreadyPlayedKeys","setAlreadyPlayedKeys","includes","DeskContainer","Mixdesk","props","RecoilRoot","onLoop","onRepeat","onSetMasterVolume","masterVolumeChange","repeat","Desk","Radio","currentValue","radio","label","isSelected","EffectParameterMap","getControlByType","EffectParameter","Control","controlContainer","onParamChange","parameterValue","EffectContainer","Knob","minDeg","maxDeg","radius","notMoveArea","startDrag","stopPropagation","knob","target","startCoordinate","moveHandler","generateDeg","clientY","startXY","distanceToStart","currentPositionToStart","step","outer","onMouseDown","inner","transform","grip","DEFAULT_VOLUME","soloMutePriority","setSoloMutePriority","setSoloMutePriorityHelper","analyserDiv","hasSolo","isPressed","onBypass","trackControls","soloButton","onMute","onSolo","buttonSeparator","isHidden","onPanChange","sendTitle","onSendLevelChange","titleText","Tracks","toggleTrackSolo","playingStateChange","trackVolumeChange","panChange","entries","playingState","index","MasterTrackContainer","Effects","loopButtonClassNames","loopButton","controllerRef","isControlsContainerFixed","setIsControlsContainerFixed","deskDiv","setFixedClass","desk","deskContainer","mixerTitle","controlsBlock","controlsContainerDisable","controlsContainer","controlsWrapper","isFixed","controls","controlsCustom","controlsRight"],"mappings":"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"}